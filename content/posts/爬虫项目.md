---
title: "爬虫项目"
date: 2020-05-06T17:07:22+08:00
draft: false
tags: ["爬虫"]
categories: ["1"]
---

#### 原则
- 使用GitHub+主干/分支模型进行开发
- 禁止直接push master
- 所有的变更通过PR进行
- 自动化代码质量检查+测试
- Checkstyle/SpotBugs
- 最基本的自动化测试覆盖
- 一切工作自动化
- 规范化提交流程
--- 
#### 创建仓库流程
- Github -new
- 建立新项目
newBranch 的时候选Apache License 2.0

- - Mvn archetype
- - IDEA - new

- - copy （cp -r ～/* .）  
- .gitigonre
- git commit --amend 就可以把这一次的commit和上一次的合并起来 

 1.  **记得要把`.iml` 放进（vi .gitignore）： `*.iml`和`target/`(放在最后一行就好)** 
 2.  更改pom 里面的groundId，artifactId
 3.  cp -r ～/.circleci . (因为之前cp ～* 的时候并不会cp到`.~`的文件)，保留checkstyle.xml以及congif.yml[自动化测试]
 4.  `.idea/` 不能够提交（在最后完成项目提交时）
 - README

---

#### 项目的设计流程-自顶向下
- 多人协作  
 使用分支可以同时进行不同的功能，且互不影响
- 模块化
- - 各模块间职责明确，界限清晰
- - 基本的文档
- - 基本的接口
- 小步提交
- - 大的变更更难以review
- - 大的变更冲突更加棘手
---

#### 项目的演进：可扩展行
- 单线程->多线程
- console -> H2 database
- H2 database ->Elasticsearch

#### 爬虫
- 新闻网站反爬比较少
- 手机网页更容易爬

#### git push 错误的文件
- 在分支上操作
1. git reset HEAD~1  把提交回滚到前1/2……各
2. 把不想提交的放进 vi .gitignore 里（.idea/）
3. git add .
4. git commit 后就会出现分支
- 以master的身份提交
1. 通过git log 查看刚才提交的提交的ID
2. git revert 撤销刚才的提交（但是刚才的提交就会消除）
- 在主干上直接把多余的文件删掉
- 只要没有push，所有行为都只有自己能够看到

#### commit massage
- 先写一行简短的总结
- 详细总结每行不要超过72word

---

### 项目
- 爬去新浪新闻页，做一个真正的爬虫
- 使用数据库储存进行数据分析
- 随着数据量的增长，前一到ES
- 做一个简单的“新闻搜索引擎”
##### 算法
- 从一个节点遍历所有节点
- 广度优先 BFS 从上到下，从左到右，1层->2层->3……  
队列数据结构、JDK的队列实现
- 深度优先 1->2->4…… 从左到右
#### 流程
1. 从链接池里拿一个链接
2. 判断链接是否处理
3. 判断链接是否需要
4. 处理
- 通过Jsoup获得HTML里面的内容
- 从池子里删除处理过的链接
5. 把新得到的链接放入链接池
6. 如果是新闻页面的话储存
7. 进入下一个循环
8. 建立H2数据库
- LINKS_TO_BE_PROCESSED
- LINKS_ALREADY_PROCESSED


- NEWS
- ID
- TITLE
- CONTENT
- URL
- CREATED_AT
- MODIFIED_AT

#### 建立H2数据库
1. 添加H2依赖
2. URL “”+/文件路径/数据库的文件名
3. creat table LINKS_TO_BE_PROCESSED{link varchar (100);} 
4. creat table nws(id bigint primary_key auto_increment,title text,content text,url varchar(100),creat_at timestamp,modified_at timestamp)
5. insert into links_to_be_processed(link)values('LINK') //设置起始的Link
#### sql数据类型
- varchar（n）可变长度字符串，最多为8,000字符
- varchar（max）可变长度字符串，最多为1,073,741,824
- text 可变长度的字符串，最多2GB文本数据(适合储存新闻)
- nchar 固定长度的Unicode字符串。最多4，000个字符

#### flyaway
- 数据库在使用的时候会不断变更，有不同的版本，flyaway可以储存数据库不同的版本，从而可以变更不同版本的**结构**
- flyaway需要在插件的地方修改URL，添加Username和password
- 即使数据库删掉也可以快速回复结构


#### ORM Object Relation Mapping 对象关系数据库
- 通过select 语句把表格里面的项目变成对象，
- 
#### Tips
1. Arraylist 从尾部删除更有效率（sive-1）。因为删除第一个元素之后，后面所有的元素都要向前移动一位。
2. linkPool.remove 删除指定位置的链接后返回被删除的链接
3. 线程卡住的时候可以通过`jps`查看当前正在运行的线程
4. 链接显示为"//……" 的话，为当前的链接，需要手动添加"https"+link 进行识别
5. 数据库的用户名和密码最好是使用final常量去声明
6. 想要关闭代码检查findbugs的错误可以通过引入包解决。在相应的地方通过注释SuppressFBWarnings（"DMI_CONSTANT_DB_PASSWORD"）
7. 如果存在无法关闭的情况，可以通过final强行关闭
8. try with resoure会自动设置关闭。try（需要声明能close的变量）
9. HTML是没有换行符的，所以爬虫的时候是爬每一各P元素，加一个换行来分隔
10. static 方法是不能够访问非static 成员的，static main 才可以运行， 非static 的main 只是一个普通的方法，不能够被运行