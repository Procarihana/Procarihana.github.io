<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Hana ">
<meta name="description" content=".ignore放什么 1 *.iml 是 intellij idea的工程配置文件，里面是当前project的一些配置信息。.Idea存放项目的配置信息，包括历史记录，版本控制信息等。 2. .idea/ 3. target/
项目结构和模型转换  external 用于存放外部团队的接口和服务，然后再Manager里面放。在接口处写注析。 exception 异常处理 config 存放MybatisBean等等的Bean Controller 存放SpringBoot对外接口（API接口）   不要有过多的处理逻辑 参数校验越早做越好  manager 组合各个业务的逻辑 先写接口后写实现 Dao Converter 用于转换 Moudle的common向service等等的转换但是不能够用于Http、数据库、IO等操作 Service 部分是给前段展示的内容，不能直接返回密码（加密后的还是可以的）等内容  添加Maven  通过Maven getting start  SpringBoot Spring boot 开发四大步  添加相应依赖   SpringBoot 引入       基础Maven引入：、spring-boot-starter-web、plugin     添加相应注解   添加Appliation类作为SpringBoot入口，并添加注解@SpringBootApplication     添加Controller类，并添加注解@RestController      @RestController == @Controller &#43; @ResponseBodymapping    编写代码 添加相应配置   在resources里添加application." />
<meta name="keywords" content=", SpringBoot, Mybatis, 数据结构, 数据模型转换, Shiro" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://procarihana.github.io/public/projects/accountingservice/" />


    <title>
        
            AccountingService :: FAFA Blog  — Just for fun
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://procarihana.github.io/public/main.d1ea4af8fd04fb24a4f8b882ea54bd04eb245427ca4baf527c81a5dab071410b.css">






<meta itemprop="name" content="AccountingService">
<meta itemprop="description" content=".ignore放什么 1 *.iml 是 intellij idea的工程配置文件，里面是当前project的一些配置信息。.Idea存放项目的配置信息，包括历史记录，版本控制信息等。 2. .idea/ 3. target/
项目结构和模型转换  external 用于存放外部团队的接口和服务，然后再Manager里面放。在接口处写注析。 exception 异常处理 config 存放MybatisBean等等的Bean Controller 存放SpringBoot对外接口（API接口）   不要有过多的处理逻辑 参数校验越早做越好  manager 组合各个业务的逻辑 先写接口后写实现 Dao Converter 用于转换 Moudle的common向service等等的转换但是不能够用于Http、数据库、IO等操作 Service 部分是给前段展示的内容，不能直接返回密码（加密后的还是可以的）等内容  添加Maven  通过Maven getting start  SpringBoot Spring boot 开发四大步  添加相应依赖   SpringBoot 引入       基础Maven引入：、spring-boot-starter-web、plugin     添加相应注解   添加Appliation类作为SpringBoot入口，并添加注解@SpringBootApplication     添加Controller类，并添加注解@RestController      @RestController == @Controller &#43; @ResponseBodymapping    编写代码 添加相应配置   在resources里添加application.">
<meta itemprop="datePublished" content="2020-08-10T20:48:22&#43;08:00" />
<meta itemprop="dateModified" content="2020-08-10T20:48:22&#43;08:00" />
<meta itemprop="wordCount" content="3599">
<meta itemprop="image" content="https://procarihana.github.io/public/"/>



<meta itemprop="keywords" content="SpringBoot,Mybatis,数据结构,数据模型转换,Shiro," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://procarihana.github.io/public/"/>

<meta name="twitter:title" content="AccountingService"/>
<meta name="twitter:description" content=".ignore放什么 1 *.iml 是 intellij idea的工程配置文件，里面是当前project的一些配置信息。.Idea存放项目的配置信息，包括历史记录，版本控制信息等。 2. .idea/ 3. target/
项目结构和模型转换  external 用于存放外部团队的接口和服务，然后再Manager里面放。在接口处写注析。 exception 异常处理 config 存放MybatisBean等等的Bean Controller 存放SpringBoot对外接口（API接口）   不要有过多的处理逻辑 参数校验越早做越好  manager 组合各个业务的逻辑 先写接口后写实现 Dao Converter 用于转换 Moudle的common向service等等的转换但是不能够用于Http、数据库、IO等操作 Service 部分是给前段展示的内容，不能直接返回密码（加密后的还是可以的）等内容  添加Maven  通过Maven getting start  SpringBoot Spring boot 开发四大步  添加相应依赖   SpringBoot 引入       基础Maven引入：、spring-boot-starter-web、plugin     添加相应注解   添加Appliation类作为SpringBoot入口，并添加注解@SpringBootApplication     添加Controller类，并添加注解@RestController      @RestController == @Controller &#43; @ResponseBodymapping    编写代码 添加相应配置   在resources里添加application."/>







    <meta property="article:published_time" content="2020-08-10 20:48:22 &#43;0800 CST" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://procarihana.github.io/public/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">知っているでしょう。</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://procarihana.github.io/public/posts">CNotes</a></li><li><a href="https://procarihana.github.io/public/tags">Tags</a></li><li><a href="https://procarihana.github.io/public/notes">PNotes</a></li><li><a href="https://procarihana.github.io/public/projects">Projects</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://procarihana.github.io/public/projects/accountingservice/">AccountingService</a></h2>

            

            <div class="post-content">
                <h2 id="ignore放什么"><code>.ignore</code>放什么</h2>
<p>1 <code>*.iml</code> 是 intellij idea的工程配置文件，里面是当前project的一些配置信息。.Idea存放项目的配置信息，包括历史记录，版本控制信息等。
2. <code>.idea/</code>
3. <code>target/</code></p>
<h2 id="项目结构和模型转换">项目结构和模型转换</h2>
<ol>
<li>external 用于存放外部团队的接口和服务，然后再Manager里面放。在接口处写注析。</li>
<li>exception 异常处理</li>
<li>config  存放MybatisBean等等的Bean</li>
<li>Controller 存放SpringBoot对外接口（API接口）</li>
</ol>
<ul>
<li>不要有过多的处理逻辑</li>
<li>参数校验越早做越好</li>
</ul>
<ol start="5">
<li>manager 组合各个业务的逻辑 先写接口后写实现</li>
<li>Dao</li>
<li>Converter 用于转换 Moudle的common向service等等的转换但是不能够用于Http、数据库、IO等操作</li>
<li>Service 部分是给前段展示的内容，不能直接返回密码（加密后的还是可以的）等内容</li>
</ol>
<h2 id="添加maven">添加Maven</h2>
<ul>
<li>通过Maven getting start</li>
</ul>
<h2 id="springboot">SpringBoot</h2>
<h4 id="spring-boot-开发四大步">Spring boot 开发四大步</h4>
<ul>
<li>添加相应依赖</li>
<li>
<ul>
<li>SpringBoot 引入</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>基础Maven引入：<!-- raw HTML omitted -->、spring-boot-starter-web、plugin</li>
</ul>
</li>
</ul>
</li>
<li>添加相应注解</li>
<li>
<ul>
<li>添加Appliation类作为SpringBoot入口，并添加注解<code>@SpringBootApplication</code></li>
</ul>
</li>
<li>
<ul>
<li>添加Controller类，并添加注解<code>@RestController</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>@RestController</code> == <code>@Controller</code> + @<code>ResponseBody</code>mapping</li>
</ul>
</blockquote>
<ul>
<li>编写代码</li>
<li>添加相应配置</li>
<li>
<ul>
<li>在<code>resources</code>里添加<code>application.properties</code>或<code>application.yml</code>都可以更改配置</li>
</ul>
</li>
</ul>
<pre><code>server:
  port: 8000(注意是冒号加空格)
</code></pre><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html</a></p>
<h2 id="mybatis">Mybatis</h2>
<ul>
<li>通过Docker 运行mysql</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">docker run <span style="color:#f92672">-</span>d <span style="color:#f92672">--</span>name AccountingService<span style="color:#f92672">-</span>mysql <span style="color:#f92672">-</span>v <span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">`</span>pwd<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">/</span>MysqlDatabase<span style="color:#f92672">:/</span>var<span style="color:#f92672">/</span>mysql<span style="color:#f92672">/</span>conf<span style="color:#f92672">.</span><span style="color:#a6e22e">d</span>  <span style="color:#f92672">-</span>v <span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">`</span>pwd<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">/</span>MysqlDatabase<span style="color:#f92672">:/</span>var<span style="color:#f92672">/</span>log<span style="color:#f92672">/</span>mysql <span style="color:#f92672">-</span>v <span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">`</span>pwd<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">/</span>MysqlDatabase<span style="color:#f92672">:/</span>var<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>mysql <span style="color:#f92672">-</span>e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span>hana <span style="color:#f92672">-</span>p 3306<span style="color:#f92672">:</span>3306 mysql<span style="color:#f92672">:</span>8<span style="color:#f92672">.</span><span style="color:#a6e22e">0</span>
</code></pre></div><ul>
<li>设置mysql</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">create table <span style="color:#960050;background-color:#1e0010">`</span>accounting_userInfo<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">(</span>
<span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span> bigint<span style="color:#f92672">(</span>20<span style="color:#f92672">)</span> unsigned NOT NULL AUTO_INCREMENT<span style="color:#f92672">,</span>
<span style="color:#960050;background-color:#1e0010">`</span>username<span style="color:#960050;background-color:#1e0010">`</span> varchar<span style="color:#f92672">(</span>64<span style="color:#f92672">)</span> NOT NULL COMMENT <span style="color:#960050;background-color:#1e0010">&#39;</span>user name<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span>
<span style="color:#960050;background-color:#1e0010">`</span>password<span style="color:#960050;background-color:#1e0010">`</span> varchar<span style="color:#f92672">(</span>64<span style="color:#f92672">)</span> NOT NULL<span style="color:#f92672">,</span>
<span style="color:#960050;background-color:#1e0010">`</span>create_time<span style="color:#960050;background-color:#1e0010">`</span> datetime<span style="color:#f92672">,</span>
<span style="color:#960050;background-color:#1e0010">`</span>update_time<span style="color:#960050;background-color:#1e0010">`</span> datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP<span style="color:#f92672">,</span>
PRIMARY KEY <span style="color:#960050;background-color:#1e0010">`</span>pk_id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">),</span>
UNIQUE KEY <span style="color:#960050;background-color:#1e0010">`</span>uk_username<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">`</span>username<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">)</span>
<span style="color:#f92672">)</span>
ENGINE<span style="color:#f92672">=</span>InnoDB AUTO_INCREMENT<span style="color:#f92672">=</span>1 DEFAULT CHARSET<span style="color:#f92672">=</span>utf8<span style="color:#f92672">;</span>
</code></pre></div><ul>
<li>
<ul>
<li>注意<code>COMMENT</code> 后使用的符号</li>
</ul>
</li>
<li>
<ul>
<li>设置引擎</li>
</ul>
</li>
<li>
<ul>
<li>设置默认字符串utf8</li>
</ul>
</li>
<li>
<ul>
<li>查看数据库table的设置</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">DESC accounting_test<span style="color:#f92672">.</span><span style="color:#a6e22e">accounting_userInfo</span>
</code></pre></div><table>
<thead>
<tr>
<th align="center">Field</th>
<th align="center">Type</th>
<th align="center">Null</th>
<th align="center">Key</th>
<th align="center">Default</th>
<th align="center">Extra</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">id</td>
<td align="center">bigint unsigned</td>
<td align="center">NO</td>
<td align="center">PRI</td>
<td align="center"><code>&lt;null&gt;</code></td>
<td align="center">auto_increment</td>
</tr>
<tr>
<td align="center">username</td>
<td align="center">varchar(64)</td>
<td align="center">NO</td>
<td align="center">UNI</td>
<td align="center"><code>&lt;null&gt;</code></td>
<td></td>
</tr>
<tr>
<td align="center">password</td>
<td align="center">varchar(64)</td>
<td align="center">NO</td>
<td align="center"></td>
<td align="center"><code>&lt;null&gt;</code></td>
<td></td>
</tr>
<tr>
<td align="center">create_time</td>
<td align="center">datetime</td>
<td align="center">YES</td>
<td align="center"></td>
<td align="center"><code>&lt;null&gt;</code></td>
<td></td>
</tr>
<tr>
<td align="center">update_time</td>
<td align="center">datetime</td>
<td align="center">YES</td>
<td align="center"></td>
<td align="center"><code>&lt;null&gt;</code></td>
<td align="center">on update CURRENT_TIMESTAMP</td>
</tr>
</tbody>
</table>
<ul>
<li>
<ul>
<li>更改数据库内容</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">UPDATE accounting_userinfo SET password<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">&#39;</span>111<span style="color:#960050;background-color:#1e0010">&#39;</span> where id<span style="color:#f92672">=</span>1
</code></pre></div><ul>
<li>添加Mybatis 和Mysql 依赖</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;!--</span> mybatis<span style="color:#f92672">-</span>spring<span style="color:#f92672">-</span>boot<span style="color:#f92672">-</span>starter <span style="color:#f92672">--&gt;</span>
<span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">mybatis</span><span style="color:#f92672">.</span><span style="color:#a6e22e">spring</span><span style="color:#f92672">.</span><span style="color:#a6e22e">boot</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>mybatis<span style="color:#f92672">-</span>spring<span style="color:#f92672">-</span>boot<span style="color:#f92672">-</span>starter<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>version<span style="color:#f92672">&gt;</span>2<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">&lt;/</span>version<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>

<span style="color:#f92672">&lt;!--</span>Mysql driver<span style="color:#f92672">--&gt;</span>
<span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>mysql<span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>mysql<span style="color:#f92672">-</span>connector<span style="color:#f92672">-</span>java<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>version<span style="color:#f92672">&gt;</span>8<span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">.</span><span style="color:#a6e22e">15</span><span style="color:#f92672">&lt;/</span>version<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
</code></pre></div><ul>
<li>添加Mapper,在Mapper里运行简单的数据库操作</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.Procarihana.AccountingService.Dao.Mapper<span style="color:#f92672">;</span>


<span style="color:#f92672">import</span> com.Procarihana.AccountingService.Moudle.presistence.UserInfo<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.ibatis.annotations.Mapper<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.ibatis.annotations.Param<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.ibatis.annotations.Select<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@Mapper</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserInfoMapper</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SELECT id, username, password, create_time, update_time FROM accounting_userinfo where id =#{id}&#34;</span><span style="color:#f92672">)</span>
    UserInfo <span style="color:#a6e22e">getUserInfoByyUserId</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Param</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span>Long id<span style="color:#f92672">);</span>

<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>在Dao里完成数据库交互</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.Procarihana.AccountingService.Dao<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.Procarihana.AccountingService.Dao.Mapper.UserInfoMapper<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.Procarihana.AccountingService.Moudle.presistence.UserInfo<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.stereotype.Repository<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@Repository</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoDaoImpl</span> <span style="color:#66d9ef">implements</span> UserInfoDao<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> UserInfoMapper userInfoMapper<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">UserInfoDaoImpl</span><span style="color:#f92672">(</span>UserInfoMapper userInfoMapper<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">userInfoMapper</span> <span style="color:#f92672">=</span> userInfoMapper<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> UserInfo <span style="color:#a6e22e">getUserInfoById</span><span style="color:#f92672">(</span>Long id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> userInfoMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByyUserId</span><span style="color:#f92672">(</span>id<span style="color:#f92672">)</span> <span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="api接口">API接口</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th align="center">Description</th>
<th align="right">Is Idempotent</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td align="center"><code>Return the current value of an object</code></td>
<td align="right">True</td>
</tr>
<tr>
<td>PUT</td>
<td align="center"><code>Replace an object, or create a named object, when applicable</code></td>
<td align="right">True</td>
</tr>
<tr>
<td>DELETE</td>
<td align="center"><code>Delete an object</code></td>
<td align="right">True</td>
</tr>
<tr>
<td>POST</td>
<td align="center"><code>Create a new object based on the data provided, or submit a command</code></td>
<td align="right">False</td>
</tr>
<tr>
<td>HEAD</td>
<td align="center"><code>Return metadata of an object for a GET response. Resources that support the GET method MAY support the HEAD method as well</code></td>
<td align="right">True</td>
</tr>
<tr>
<td>PATCH</td>
<td align="center"><code>Apply a partial update to an object</code></td>
<td align="right">False</td>
</tr>
<tr>
<td>OPTIONS</td>
<td align="center"><code>Get information about a request; see below for details.</code></td>
<td align="right">True</td>
</tr>
</tbody>
</table>
<ul>
<li>幂等（）</li>
<li>
<ul>
<li>一次请求和多次请求某个资源应该具有同样的副作用，并非相同结果</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><code>Get</code> 获取资源（不应有副作用），但结果不一定相同
<a href="http://api.accountingService.com/resources/latest">http://api.accountingService.com/resources/latest</a></li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><code>POST</code> 创建资源（执行动作，有副作用） 多次提交创建出不同的资源（需要有防止多次频繁提交的操作）&mdash;&gt;不是幂等</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>http://api.accountingService.com/resources/
http://api.accountingService.com/resources/1
http://api.accountingService.com/resources/2
</code></pre><ul>
<li>
<ul>
<li>
<ul>
<li><code>PUT</code>更新操作，也是有副作用，满足幂等性</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>https://api.hardcore.com/resources/123
更新id为123的资源
</code></pre><ul>
<li>
<ul>
<li>幂等性只与后端服务器的实际状态有关，而每一次请求接收到的状态码不一定相同。</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>例：<code>DELETE </code> /idX/delete HTTP/1.1是幂等的，即便是不同请求之间接收到的状态码不一样：</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>DELETE /idX/delete HTTP/1.1   -&gt; Returns 200 if idX exists
DELETE /idX/delete HTTP/1.1   -&gt; Returns 404 as it just got deleted
DELETE /idX/delete HTTP/1.1   -&gt; Returns 404
</code></pre><ul>
<li>
<ul>
<li>类似：f(x)=f(f(x))</li>
</ul>
</li>
<li>
<p>Response格式</p>
</li>
<li>
<ul>
<li>基本要求</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>JSON属性应该用camelCased</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>Service应该将JSON作为默认编码</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>Service必须要支持application/json，并且将application/json作为默认response format</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;user&#34;</span>: {
    <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>,
    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;hardcore&#34;</span>
  }
}
</code></pre></div><ul>
<li>
<ul>
<li>错误请求的Response</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><strong>一定要用HTTP status code</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>最简单的三类：</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>OK 200</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>Client side error：4XX</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>Service side error： 5XX</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;error&#34;</span>: {
    <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#e6db74">&#34;BadArgument&#34;</span>,
    <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Multiple errors in ContactInfo data&#34;</span>,
    <span style="color:#f92672">&#34;target&#34;</span>: <span style="color:#e6db74">&#34;ContactInfo&#34;</span>,
    <span style="color:#f92672">&#34;details&#34;</span>: [
      {
        <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#e6db74">&#34;NullValue&#34;</span>,
        <span style="color:#f92672">&#34;target&#34;</span>: <span style="color:#e6db74">&#34;PhoneNumber&#34;</span>,
        <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Phone number must not be null&#34;</span>
      },
      {
        <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#e6db74">&#34;NullValue&#34;</span>,
        <span style="color:#f92672">&#34;target&#34;</span>: <span style="color:#e6db74">&#34;LastName&#34;</span>,
        <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Last name must not be null&#34;</span>
      },
      {
        <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#e6db74">&#34;MalformedValue&#34;</span>,
        <span style="color:#f92672">&#34;target&#34;</span>: <span style="color:#e6db74">&#34;Address&#34;</span>,
        <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Address is not valid&#34;</span>
      }
    ]
  }
}
</code></pre></div><h2 id="异常处理exception">异常处理Exception</h2>
<ul>
<li>异常的报错给前端为Service部分，通过<code>ServiceException</code>来定义报错信息的内容</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> lombok.Data<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Accounting Service Exception
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServiceException</span> <span style="color:#66d9ef">extends</span> RuntimeException <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> statusCode<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String errorCode<span style="color:#f92672">;</span><span style="color:#75715e">//biz error code
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> ServiceException<span style="color:#f92672">.</span><span style="color:#a6e22e">ErrorType</span> errorType<span style="color:#f92672">;</span><span style="color:#75715e">//Service,Client,Unknown
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">enum</span> ErrorType <span style="color:#f92672">{</span>
        Cline<span style="color:#f92672">,</span>
        Service<span style="color:#f92672">,</span>
        Unknown
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServiceException</span><span style="color:#f92672">(</span>String message<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>message<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><ul>
<li>通过<code>Optional</code>给出异常信息</li>
<li>
<ul>
<li>先写出一个目标异常</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#f92672">import</span> org.springframework.http.HttpStatus<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.ResponseStatus<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Accounting Service ResourceNotFoundException
</span><span style="color:#75715e"> */</span>

<span style="color:#a6e22e">@ResponseStatus</span><span style="color:#f92672">(</span>code <span style="color:#f92672">=</span> HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ResourceNotFoundException</span> <span style="color:#66d9ef">extends</span> ServiceException <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ResourceNotFoundException</span><span style="color:#f92672">(</span>String message<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>message<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setStatusCode</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>通过<code>Optional</code>得出结果或者抛出异常</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> UserInfo <span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>Long userId<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">//com.Procarihana.AccountingService.Moudle.presistence.UserInfo userInfo = userInfoDao.getUserInfoById(userId);
</span><span style="color:#75715e"></span>        val userInfo <span style="color:#f92672">=</span> Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">ofNullable</span><span style="color:#f92672">(</span>userInfoDao<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoById</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">))</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">orElseThrow</span><span style="color:#f92672">(()-&gt;</span><span style="color:#66d9ef">new</span> ResourceNotFoundException<span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34; User %s was not found&#34;</span><span style="color:#f92672">,</span>userId<span style="color:#f92672">)));</span>
        UserInfo commonUserInfo <span style="color:#f92672">=</span> userInfoPresToComConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> commonUserInfo<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>更改异常status &ndash;&gt; 通过<code>@RseonseStatus</code>更改status</li>
<li>
<ul>
<li>Eg：<code>500</code>&ndash;&gt;<code>404</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@ResponseStatus</span><span style="color:#f92672">(</span>code <span style="color:#f92672">=</span> HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ResourceNotFoundException</span> <span style="color:#66d9ef">extends</span> ServiceException <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ResourceNotFoundException</span><span style="color:#f92672">(</span>String message<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>message<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setStatusCode</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span><span style="color:#f92672">());</span>

    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2020-08-12T02:53:49.581+0000&#34;</span>,
    <span style="color:#f92672">&#34;status&#34;</span>: <span style="color:#ae81ff">500</span>,
    <span style="color:#f92672">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;Internal Server Error&#34;</span>,
    <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34; User 2 was not found&#34;</span>,
    <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/v1/users/2&#34;</span>
}
</code></pre></div><p>===&gt;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2020-08-12T02:50:36.129+0000&#34;</span>,
    <span style="color:#f92672">&#34;status&#34;</span>: <span style="color:#ae81ff">404</span>,
    <span style="color:#f92672">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;Not Found&#34;</span>,
    <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34; User 2 was not found&#34;</span>,
    <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/v1/users/2&#34;</span>
}
</code></pre></div><ul>
<li>自定义ErrorResponse</li>
<li>
<ul>
<li>先写一个异常错误信息类</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Data</span>
<span style="color:#a6e22e">@Builder</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ErrorResponse</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> String code<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> ServiceException<span style="color:#f92672">.</span><span style="color:#a6e22e">ErrorType</span> errorType<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String massage<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> statusCode<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>放在需要自定义异常报错的地方,通过bulider模式完成异常报错的自定义。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserController</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> UserInfoManager userInfoManager<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> UserInfoCToSeConverter userInfoCToSeConverter<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">UserController</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> UserInfoManager userInfoManager<span style="color:#f92672">,</span>
                          <span style="color:#66d9ef">final</span> UserInfoCToSeConverter userInfoCToSeConverter
                          <span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">userInfoManager</span> <span style="color:#f92672">=</span> userInfoManager<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">userInfoCToSeConverter</span> <span style="color:#f92672">=</span> userInfoCToSeConverter<span style="color:#f92672">;</span>

    <span style="color:#f92672">}</span>


    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/{id}&#34;</span><span style="color:#f92672">,</span>produces <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;application/json; charset=utf-8&#34;</span> <span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;?&gt;</span> getUserInfoByUserId<span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span> Long userId<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Get user info by user id {}&#34;</span><span style="color:#f92672">,</span> userId<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            UserInfo userInfo <span style="color:#f92672">=</span> userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> ResponseEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">ok</span><span style="color:#f92672">(</span>userInfoCToSeConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>ResourceNotFoundException ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> ResponseEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">status</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">body</span><span style="color:#f92672">(</span>ErrorResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">code</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;USER_NOT_FOUND&#34;</span><span style="color:#f92672">)</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">errorType</span><span style="color:#f92672">(</span>ServiceException<span style="color:#f92672">.</span><span style="color:#a6e22e">ErrorType</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Cline</span><span style="color:#f92672">)</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">massage</span><span style="color:#f92672">(</span>ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">())</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">statusCode</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span><span style="color:#f92672">())</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>异常信息</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#e6db74">&#34;USER_NOT_FOUND&#34;</span>,
    <span style="color:#f92672">&#34;errorType&#34;</span>: <span style="color:#e6db74">&#34;Cline&#34;</span>,
    <span style="color:#f92672">&#34;massage&#34;</span>: <span style="color:#e6db74">&#34; User 2 was not found&#34;</span>,
    <span style="color:#f92672">&#34;statusCode&#34;</span>: <span style="color:#ae81ff">404</span>
}
</code></pre></div><ul>
<li>
<ul>
<li>通过统一处理<code>try/catch</code>来优化代码(放在一个类里)</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><code>@RestControllerAdvice</code>控制增强</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RestControllerAdvice</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GlobalExceptionHandler</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@ExceptionHandler</span><span style="color:#f92672">(</span>ResourceNotFoundException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    ResponseEntity<span style="color:#f92672">&lt;?&gt;</span> handleResourceNotFoundException<span style="color:#f92672">(</span>ResourceNotFoundException exception<span style="color:#f92672">){</span>
         ErrorResponse errorResponse <span style="color:#f92672">=</span> ErrorResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                 <span style="color:#f92672">.</span><span style="color:#a6e22e">statusCode</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span><span style="color:#f92672">())</span>
                 <span style="color:#f92672">.</span><span style="color:#a6e22e">code</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;USER_NOT_FOUND&#34;</span><span style="color:#f92672">)</span>
                 <span style="color:#f92672">.</span><span style="color:#a6e22e">errorType</span><span style="color:#f92672">(</span>ServiceException<span style="color:#f92672">.</span><span style="color:#a6e22e">ErrorType</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Cline</span><span style="color:#f92672">)</span>
                 <span style="color:#f92672">.</span><span style="color:#a6e22e">massage</span><span style="color:#f92672">(</span>exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">())</span>
                 <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
         <span style="color:#66d9ef">return</span> ResponseEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">status</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">)</span>
                 <span style="color:#f92672">.</span><span style="color:#a6e22e">body</span><span style="color:#f92672">(</span>errorResponse<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>
<ul>
<li>优化后</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/{id}&#34;</span><span style="color:#f92672">,</span> produces <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;application/json; charset=utf-8&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;?&gt;</span> getUserInfoByUserId<span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span> Long userId<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Get user info by user id {}&#34;</span><span style="color:#f92672">,</span> userId<span style="color:#f92672">);</span>
        UserInfo userInfo <span style="color:#f92672">=</span> userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> ResponseEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">ok</span><span style="color:#f92672">(</span>userInfoCToSeConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">));</span> <span style="color:#75715e">//为空的时候会抛出异常，所以不会为空
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>设置一个通用的Exception来处理异常</li>
<li>
<ul>
<li><code>setErrorCode</code>一般很少会直接定义，会根据不同的需要在return处来决定，除非是简单且非常明确的异常</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InvalidParameterException</span> <span style="color:#66d9ef">extends</span> ServiceException<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">InvalidParameterException</span><span style="color:#f92672">(</span>String message<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>message<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setStatusCode</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">BAD_REQUEST</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span><span style="color:#f92672">());</span> <span style="color:#75715e">//BAD_REQUEST.value()为400.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setErrorCode</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INVALID_PARAMETER&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setErrorType</span><span style="color:#f92672">(</span>ErrorType<span style="color:#f92672">.</span><span style="color:#a6e22e">Cline</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>使用</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RestControllerAdvice</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GlobalExceptionHandler</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@ExceptionHandler</span><span style="color:#f92672">(</span>InvalidParameterException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    ResponseEntity<span style="color:#f92672">&lt;?&gt;</span> handleInvalidParameterException<span style="color:#f92672">(</span>InvalidParameterException exception<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        ErrorResponse errorResponse <span style="color:#f92672">=</span> ErrorResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">statusCode</span><span style="color:#f92672">(</span>exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatusCode</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">code</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;USER_NOT_FOUND&#34;</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">errorType</span><span style="color:#f92672">(</span>exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getErrorType</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">massage</span><span style="color:#f92672">(</span>exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">return</span> ResponseEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">status</span><span style="color:#f92672">(</span>exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatusCode</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> 0 <span style="color:#f92672">?</span>
                exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatusCode</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">:</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">INTERNAL_SERVER_ERROR</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span><span style="color:#f92672">())</span> <span style="color:#75715e">//如果为空就返回500
</span><span style="color:#75715e"></span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">body</span><span style="color:#f92672">(</span>errorResponse<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>当Exception 继承某个类的时候，通过↓，可以根据限制条件来自动选择执行Exctption</li>
<li>
<ul>
<li>Eg：Exception 都继承ServiceException</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InvalidParameterException</span> <span style="color:#66d9ef">extends</span> ServiceException<span style="color:#f92672">{</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ResourceNotFoundException</span> <span style="color:#66d9ef">extends</span> ServiceException <span style="color:#f92672">{</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>根据使用的条件</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/{id}&#34;</span><span style="color:#f92672">,</span> produces <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;application/json; charset=utf-8&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;?&gt;</span> getUserInfoByUserId<span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span> Long userId<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Get user info by user id {}&#34;</span><span style="color:#f92672">,</span> userId<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>userId <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">|</span>userId <span style="color:#f92672">&lt;=</span>0<span style="color:#f92672">){</span>
         <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InvalidParameterException<span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;The user id %s is invalid.&#34;</span><span style="color:#f92672">,</span>userId<span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span>
        UserInfo userInfo <span style="color:#f92672">=</span> userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> ResponseEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">ok</span><span style="color:#f92672">(</span>userInfoCToSeConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">));</span> <span style="color:#75715e">//为空的时候会抛出异常，所以不会为空
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>直接执行对应的exception，从而能够全局地处理异常</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RestControllerAdvice</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GlobalExceptionHandler</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@ExceptionHandler</span><span style="color:#f92672">(</span>ServiceException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    ResponseEntity<span style="color:#f92672">&lt;?&gt;</span> handleParameterException<span style="color:#f92672">(</span>ServiceException exception<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        ErrorResponse errorResponse <span style="color:#f92672">=</span> ErrorResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">statusCode</span><span style="color:#f92672">(</span>exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatusCode</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">code</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;USER_NOT_FOUND&#34;</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">errorType</span><span style="color:#f92672">(</span>exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getErrorType</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">massage</span><span style="color:#f92672">(</span>exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">return</span> ResponseEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">status</span><span style="color:#f92672">(</span>exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatusCode</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> 0 <span style="color:#f92672">?</span>
                exception<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatusCode</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">:</span> HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">INTERNAL_SERVER_ERROR</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span><span style="color:#f92672">())</span> <span style="color:#75715e">//如果为空就返回500
</span><span style="color:#75715e"></span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">body</span><span style="color:#f92672">(</span>errorResponse<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><h2 id="单元测试">单元测试</h2>
<ul>
<li>SpringBoot tset maven</li>
<li>
<ul>
<li>exclusion 是为了把Junit4排除，从而使用Junit5</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">       <span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">springframework</span><span style="color:#f92672">.</span><span style="color:#a6e22e">boot</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>spring<span style="color:#f92672">-</span>boot<span style="color:#f92672">-</span>starter<span style="color:#f92672">-</span>test<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>scope<span style="color:#f92672">&gt;</span>test<span style="color:#f92672">&lt;/</span>scope<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>exclusions<span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;</span>exclusion<span style="color:#f92672">&gt;</span>
                    <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">junit</span><span style="color:#f92672">.</span><span style="color:#a6e22e">vintage</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
                    <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>junit<span style="color:#f92672">-</span>vintage<span style="color:#f92672">-</span>engine<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;/</span>exclusion<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;/</span>exclusions<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
</code></pre></div><ul>
<li>package :utils</li>
<li>
<ul>
<li>用于继承需要测试的接口，然后build一个实例</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>接口</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Mapper</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserInfoMapper</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SELECT id, username, password, create_time, update_time FROM accounting_userinfo where id =#{id}&#34;</span><span style="color:#f92672">)</span>
    UserInfo <span style="color:#a6e22e">getUserInfoByyUserId</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Param</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span>Long id<span style="color:#f92672">);</span>

<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>
<ul>
<li>实现</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoMapperTestLmp</span> <span style="color:#66d9ef">implements</span> UserInfoMapper <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> UserInfo <span style="color:#a6e22e">getUserInfoByyUserId</span><span style="color:#f92672">(</span>Long id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> id <span style="color:#f92672">&gt;</span>0<span style="color:#f92672">?</span>UserInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">(</span>id<span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">username</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TestUsername&#34;</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">password</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TestPassword&#34;</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">updateTime</span><span style="color:#f92672">(</span>LocalDate<span style="color:#f92672">.</span><span style="color:#a6e22e">now</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">createTime</span><span style="color:#f92672">(</span>LocalDate<span style="color:#f92672">.</span><span style="color:#a6e22e">now</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">():</span><span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li><code>@BeforeEach</code></li>
<li><code>assertEquals</code></li>
<li><code>assertThrow</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">	 * &lt;em&gt;Assert&lt;/em&gt; that execution of the supplied {@code executable} throws
</span><span style="color:#75715e">	 * an exception of the {@code expectedType} and returns the exception.
</span><span style="color:#75715e">	 *
</span><span style="color:#75715e">	 * &lt;p&gt;If no exception is thrown, or if an exception of a different type is
</span><span style="color:#75715e">	 * thrown, this method will fail.
</span><span style="color:#75715e">	 *
</span><span style="color:#75715e">	 * &lt;p&gt;If you do not want to perform additional checks on the exception instance,
</span><span style="color:#75715e">	 * simply ignore the return value.
</span><span style="color:#75715e">	 */</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>T <span style="color:#66d9ef">extends</span> Throwable<span style="color:#f92672">&gt;</span> T <span style="color:#a6e22e">assertThrows</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> expectedType<span style="color:#f92672">,</span> Executable executable<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">return</span> AssertThrows<span style="color:#f92672">.</span><span style="color:#a6e22e">assertThrows</span><span style="color:#f92672">(</span>expectedType<span style="color:#f92672">,</span> executable<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testUserInfoByInvalidUserId</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        Long userId <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1L<span style="color:#f92672">;</span>
        Assertions<span style="color:#f92672">.</span><span style="color:#a6e22e">assertThrows</span><span style="color:#f92672">(</span>ResourceNotFoundException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#f92672">()</span> <span style="color:#f92672">-&gt;</span> userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
</code></pre></div><ul>
<li><code>assertThat</code> AssertJ</li>
<li>
<ul>
<li>引入的包要正确<code>import static org.assertj.core.api.Assertions.assertThat;</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testUserInfoByUserId</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        Long userId <span style="color:#f92672">=</span> 1L<span style="color:#f92672">;</span>

        UserInfo result <span style="color:#f92672">=</span> userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">);</span>
        <span style="color:#75715e">//AssertJ
</span><span style="color:#75715e"></span>        assertThat<span style="color:#f92672">(</span>result<span style="color:#f92672">).</span><span style="color:#a6e22e">isNotNull</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">hasFieldOrPropertyWithValue</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">,</span>userId<span style="color:#f92672">)</span>
                 <span style="color:#75715e">//有没有这个属性,并核对属性的内容是否正确
</span><span style="color:#75715e"></span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">hasFieldOrPropertyWithValue</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;TestUsername&#34;</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">hasFieldOrPropertyWithValue</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;TestPassword&#34;</span><span style="color:#f92672">);</span>

    <span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>和没有Mockito对比,需要去创建一个真实的对象</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoManagerTest</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> UserInfoManager userInfoManager<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@BeforeEach</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        val userInfoMapper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UserInfoMapperTestImp<span style="color:#f92672">();</span>
        val userInfoPresToComConverter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UserInfoPresToComConverter<span style="color:#f92672">();</span>
        val userInfoDao <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UserInfoDaoImpl<span style="color:#f92672">(</span>userInfoMapper<span style="color:#f92672">);</span>
        userInfoManager <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UserInfoManagerImpl<span style="color:#f92672">(</span>userInfoDao<span style="color:#f92672">,</span> userInfoPresToComConverter<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testUserInfoByUserId</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        Long userId <span style="color:#f92672">=</span> 1L<span style="color:#f92672">;</span>

        UserInfo result <span style="color:#f92672">=</span> userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">);</span>

        Assertions<span style="color:#f92672">.</span><span style="color:#a6e22e">assertEquals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TestUsername&#34;</span><span style="color:#f92672">,</span> result<span style="color:#f92672">.</span><span style="color:#a6e22e">getUsername</span><span style="color:#f92672">());</span>
        Assertions<span style="color:#f92672">.</span><span style="color:#a6e22e">assertEquals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TestPassword&#34;</span><span style="color:#f92672">,</span> result<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">());</span>

    <span style="color:#f92672">}</span>

</code></pre></div><ul>
<li>Mockito</li>
<li>
<ul>
<li><code>verify</code> == <code>assert</code>，都是用于判断</li>
</ul>
</li>
<li>
<ul>
<li><code>when/then</code> 用于设定一个模拟对象进行测试</li>
</ul>
</li>
<li>
<ul>
<li><code>do</code> == <code>when/then</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>doNothing<br>
doReturn<br>
doThrow</p>
<ul>
<li>注意使用的方法</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> doThrow<span style="color:#f92672">(</span>exception<span style="color:#f92672">).</span><span style="color:#a6e22e">when</span><span style="color:#f92672">(</span>mock<span style="color:#f92672">).</span><span style="color:#a6e22e">someVoidMethod</span><span style="color:#f92672">();</span>
</code></pre></div><p>sort？？？</p>
<ul>
<li>
<ul>
<li>区别在于Mockito在调用<code>spy()</code>进行实现的过程中，执行<code>when/then</code> 的时候，如果有规定模拟的结果就会返回该模拟结果，如果没有，则会返回真是数据的结果。而执行<code>do</code>方法则会和普通的调用<code>mock()</code>一样只会调用提前设置好的虚拟对象和结果，不会返回真实的数据</li>
</ul>
</li>
<li>
<ul>
<li><code>spy()</code>如果一个方法定制了返回值或者异常，那么就会按照定制的方式被调用执行；如果一个方法没被定制，那么调用的就是真实类的方法。
cnblogs.com/softidea/p/4204389.html</li>
</ul>
</li>
<li>
<p><code>MockitoAnnotations.initMocks(this);</code>  用来体型Mockito 识别对象</p>
</li>
</ul>
<blockquote>
<p>MockitoAnnotations.initMocks(this); initializes fields annotated with Mockito annotations.
See also {@link MockitoSession} which not only initializes mocks
but also adds extra validation for cleaner tests!</p>
</blockquote>
<ul>
<li>ControllerTest</li>
<li>
<ul>
<li>MockMvc 虚拟出一个Mvc用于测试</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@ExtendWith</span><span style="color:#f92672">(</span>MockitoExtension<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ExtendWith</span><span style="color:#f92672">(</span>SpringExtension<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserControllerTest</span> <span style="color:#f92672">{</span>
 <span style="color:#66d9ef">private</span> MockMvc mockMvc<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>运行Controller 需要用到的业务通过Mock虚拟出来,如果是简单的转换等的方法可以通过new 出新的对象来完成</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@Mock</span>
 <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserControllerTest</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> UserInfoManager userInfoManager<span style="color:#f92672">;</span>
 <span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>装配mockMvc</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@BeforeEach</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        mockMvc <span style="color:#f92672">=</span> MockMvcBuilders<span style="color:#f92672">.</span><span style="color:#a6e22e">standaloneSetup</span><span style="color:#f92672">(</span>
                <span style="color:#66d9ef">new</span> UserController<span style="color:#f92672">(</span>
                        userInfoManager<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> UserInfoCToSeConverter<span style="color:#f92672">()))</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">setControllerAdvice</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> GlobalExceptionHandler<span style="color:#f92672">())</span> <span style="color:#75715e">//通过`setControllerAdvice`引入自定义的异常
</span><span style="color:#75715e"></span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>Mock出来的虚拟对象如果要进行多次的测试，且每次测试对象的内容都不一样的时候，要进行清空</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">   <span style="color:#a6e22e">@AfterEach</span>
    <span style="color:#66d9ef">void</span>  <span style="color:#a6e22e">teatDown</span><span style="color:#f92672">(){</span>
        reset<span style="color:#f92672">(</span>userInfoManager<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>检测返回的json结果是否正确</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#f92672">.</span><span style="color:#a6e22e">andExpect</span><span style="color:#f92672">(</span>content<span style="color:#f92672">().</span><span style="color:#a6e22e">string</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ObjectMapper<span style="color:#f92672">().</span><span style="color:#a6e22e">writeValueAsString</span><span style="color:#f92672">(</span>userInfoS<span style="color:#f92672">)))</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">andExpect</span><span style="color:#f92672">(</span>content<span style="color:#f92672">().</span><span style="color:#a6e22e">string</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;{\&#34;id\&#34;:2,\&#34;username\&#34;:\&#34;666\&#34;,\&#34;password\&#34;:null}&#34;</span><span style="color:#f92672">));</span>
</code></pre></div><ul>
<li>
<ul>
<li>进行测试的时候</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>要注意<code>@Test</code>引入的包是否正确</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><code>doReturn(返回对象).when(条件对象).条件对象的方法</code>格式</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li><code>mockMvc.perform(get(&quot;&quot;))</code>要以&rdquo;/&ldquo;开头</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>最后要用<code>verify</code>来检测<code>@Mock</code>的对象是否正常运行</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getUserInfoByUserIdTest</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        String username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;666&#34;</span><span style="color:#f92672">;</span>
        String password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;666&#34;</span><span style="color:#f92672">;</span>
        LocalDate createTime <span style="color:#f92672">=</span> LocalDate<span style="color:#f92672">.</span><span style="color:#a6e22e">now</span><span style="color:#f92672">();</span>
        LocalDate updateTime <span style="color:#f92672">=</span> LocalDate<span style="color:#f92672">.</span><span style="color:#a6e22e">now</span><span style="color:#f92672">();</span>
        Long userId <span style="color:#f92672">=</span> 2L<span style="color:#f92672">;</span>
        UserInfo userInfoC <span style="color:#f92672">=</span> UserInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">username</span><span style="color:#f92672">(</span>username<span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">password</span><span style="color:#f92672">(</span>password<span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
        doReturn<span style="color:#f92672">(</span>userInfoC<span style="color:#f92672">).</span><span style="color:#a6e22e">when</span><span style="color:#f92672">(</span>userInfoManager<span style="color:#f92672">).</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>anyLong<span style="color:#f92672">());</span>


        mockMvc<span style="color:#f92672">.</span><span style="color:#a6e22e">perform</span><span style="color:#f92672">(</span>get<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/v1.0/users/&#34;</span> <span style="color:#f92672">+</span> userId<span style="color:#f92672">))</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">andExpect</span><span style="color:#f92672">(</span>status<span style="color:#f92672">().</span><span style="color:#a6e22e">isOk</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">andExpect</span><span style="color:#f92672">(</span>content<span style="color:#f92672">().</span><span style="color:#a6e22e">contentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;application/json;charset=utf-8 &#34;</span><span style="color:#f92672">))</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">andExpect</span><span style="color:#f92672">(</span>content<span style="color:#f92672">().</span><span style="color:#a6e22e">string</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;{\&#34;id\&#34;:2,\&#34;username\&#34;:\&#34;666\&#34;,\&#34;password\&#34;:null}&#34;</span><span style="color:#f92672">));</span>
        verify<span style="color:#f92672">(</span>userInfoManager<span style="color:#960050;background-color:#1e0010">，</span>never<span style="color:#f92672">).</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>anyLong<span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>

</code></pre></div><h2 id="checkstyle">CheckStyle</h2>
<ul>
<li>maven</li>
<li>
<ul>
<li><code>&lt;phase&gt;validate</code>是在没有编译代码的时候进行检查，如果是verify则是在最后的阶段进行检查</li>
</ul>
</li>
<li>
<ul>
<li>引用后要记得更改configLocation<code>&lt;configLocation&gt;checkstyle.xml&lt;/configLocation&gt;</code>&ndash;&gt;</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;</span>plugin<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">apache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">maven</span><span style="color:#f92672">.</span><span style="color:#a6e22e">plugins</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>maven<span style="color:#f92672">-</span>checkstyle<span style="color:#f92672">-</span>plugin<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>version<span style="color:#f92672">&gt;</span>3<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">&lt;/</span>version<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>configuration<span style="color:#f92672">&gt;</span>
          <span style="color:#f92672">&lt;</span>configLocation<span style="color:#f92672">&gt;</span>$<span style="color:#f92672">{</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">basedir</span><span style="color:#f92672">}/</span>src<span style="color:#f92672">/</span>main<span style="color:#f92672">/</span>resources<span style="color:#f92672">/</span>checkstyle_checks<span style="color:#f92672">.</span><span style="color:#a6e22e">xml</span><span style="color:#f92672">&lt;/</span>configLocation<span style="color:#f92672">&gt;</span>
          <span style="color:#f92672">&lt;</span>encoding<span style="color:#f92672">&gt;</span>UTF<span style="color:#f92672">-</span>8<span style="color:#f92672">&lt;/</span>encoding<span style="color:#f92672">&gt;</span>
     <span style="color:#f92672">&lt;</span>consoleOutput<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">true</span><span style="color:#f92672">&lt;/</span>consoleOutput<span style="color:#f92672">&gt;</span>
     <span style="color:#f92672">&lt;</span>failsOnError<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">true</span><span style="color:#f92672">&lt;/</span>failsOnError<span style="color:#f92672">&gt;</span>
     <span style="color:#f92672">&lt;</span>linkXRef<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">false</span><span style="color:#f92672">&lt;/</span>linkXRef<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;/</span>configuration<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>executions<span style="color:#f92672">&gt;</span>
     <span style="color:#f92672">&lt;</span>execution<span style="color:#f92672">&gt;</span>
       <span style="color:#f92672">&lt;</span>id<span style="color:#f92672">&gt;</span>validate<span style="color:#f92672">&lt;/</span>id<span style="color:#f92672">&gt;</span>
       <span style="color:#f92672">&lt;</span>phase<span style="color:#f92672">&gt;</span>validate<span style="color:#f92672">&lt;/</span>phase<span style="color:#f92672">&gt;</span>
       <span style="color:#f92672">&lt;</span>goals<span style="color:#f92672">&gt;</span>
         <span style="color:#f92672">&lt;</span>goal<span style="color:#f92672">&gt;</span>check<span style="color:#f92672">&lt;/</span>goal<span style="color:#f92672">&gt;</span>
       <span style="color:#f92672">&lt;/</span>goals<span style="color:#f92672">&gt;</span>
     <span style="color:#f92672">&lt;/</span>execution<span style="color:#f92672">&gt;</span>
   <span style="color:#f92672">&lt;/</span>executions<span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;/</span>plugin<span style="color:#f92672">&gt;</span>
</code></pre></div><ul>
<li><code>checstyle_checks.xml</code> 一般会放在resources 里</li>
<li>
<ul>
<li><code>&lt;property name=&quot;severity&quot; value=&quot;error&quot;/&gt;</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>运行的时候CheckStyle出现问题就会直接失败,而原始状态的<code>warning</code>则只是警告</p>
</blockquote>
<ul>
<li>
<ul>
<li><code>&lt;property name=&quot;basicOffset&quot; value=&quot;4&quot;/&gt;</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>缩进 大多数的库缩进都是4个空格，最好checkstyle 的时候改成4</p>
</blockquote>
<ul>
<li>
<ul>
<li>import</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>AvoidStarImport</code> 禁止包名以* 的形式省略</li>
<li><code>UnusedImports</code> 不能存在没有使用的Imports</li>
<li><code> &lt;module name=&quot;CustomImportOrder&quot;&gt;</code>用于管理imports顺序<br>
顺序：先Static，然后是special的</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;customImportOrderRules&#34;</span>
                      value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;STATIC###SPECIAL_IMPORTS###THIRD_PARTY_PACKAGE###STANDARD_JAVA_PACKAGE&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#f92672">&lt;</span>module name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;AvoidStarImport&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;</span>module name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;RedundantImport&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;</span>module name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UnusedImports&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;</span>module name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;CustomImportOrder&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;specialImportsRegExp&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;(com.Procarihana)&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;standardPackageRegExp&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;^(java|javax)\.&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;!--&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;thirdPartyPackageRegExp&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;^(com|org|lombok)\.&#34;</span><span style="color:#f92672">/&gt;--&gt;</span>
            <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sortImportsInGroupAlphabetically&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;separateLineBetweenGroups&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;customImportOrderRules&#34;</span>
                      value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;STATIC###SPECIAL_IMPORTS###THIRD_PARTY_PACKAGE###STANDARD_JAVA_PACKAGE&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><ul>
<li>运行：mvn checkstyle:check</li>
<li>target里的result可以看到错误的记录</li>
<li>
<ul>
<li><code>CheckStyle-Idea</code> plugin安装，方便修改错误<br>
<a href="https://www.jianshu.com/p/6b51b8ceefa5">https://www.jianshu.com/p/6b51b8ceefa5</a></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>注意checkStyle-ide 和 maven checkStyle（在version点进去后可以看到） 版本一置</li>
<li>更改code style 时要注意查看一下有没有问题</li>
</ul>
</blockquote>
<h2 id="sportbug">SportBug</h2>
<ul>
<li>pom.xml
<a href="https://www.jacoco.org/jacoco/trunk/doc/examples/build/pom.xml">https://www.jacoco.org/jacoco/trunk/doc/examples/build/pom.xml</a></li>
<li>期望代码检查的覆盖率为0.6</li>
<li>
<ul>
<li>测试后可以通过<code>target -&gt; site -&gt; jacoco -&gt; index.xml</code>里面找到覆盖情况</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;</span>limit<span style="color:#f92672">&gt;</span>
                                            <span style="color:#f92672">&lt;</span>counter<span style="color:#f92672">&gt;</span>COMPLEXITY<span style="color:#f92672">&lt;/</span>counter<span style="color:#f92672">&gt;</span>
                                            <span style="color:#f92672">&lt;</span>value<span style="color:#f92672">&gt;</span>COVEREDRATIO<span style="color:#f92672">&lt;/</span>value<span style="color:#f92672">&gt;</span>
                                            <span style="color:#f92672">&lt;</span>minimum<span style="color:#f92672">&gt;</span>0<span style="color:#f92672">.</span><span style="color:#a6e22e">60</span><span style="color:#f92672">&lt;/</span>minimum<span style="color:#f92672">&gt;</span>
                                        <span style="color:#f92672">&lt;/</span>limit<span style="color:#f92672">&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;</span>plugin<span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">jacoco</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>jacoco<span style="color:#f92672">-</span>maven<span style="color:#f92672">-</span>plugin<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;</span>version<span style="color:#f92672">&gt;</span>0<span style="color:#f92672">.</span><span style="color:#a6e22e">8</span><span style="color:#f92672">.</span><span style="color:#a6e22e">6</span><span style="color:#f92672">-</span>SNAPSHOT<span style="color:#f92672">&lt;/</span>version<span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;</span>executions<span style="color:#f92672">&gt;</span>
                    <span style="color:#f92672">&lt;</span>execution<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;</span>id<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">default</span><span style="color:#f92672">-</span>prepare<span style="color:#f92672">-</span>agent<span style="color:#f92672">&lt;/</span>id<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;</span>goals<span style="color:#f92672">&gt;</span>
                            <span style="color:#f92672">&lt;</span>goal<span style="color:#f92672">&gt;</span>prepare<span style="color:#f92672">-</span>agent<span style="color:#f92672">&lt;/</span>goal<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;/</span>goals<span style="color:#f92672">&gt;</span>
                    <span style="color:#f92672">&lt;/</span>execution<span style="color:#f92672">&gt;</span>
                    <span style="color:#f92672">&lt;</span>execution<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;</span>id<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">default</span><span style="color:#f92672">-</span>report<span style="color:#f92672">&lt;/</span>id<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;</span>goals<span style="color:#f92672">&gt;</span>
                            <span style="color:#f92672">&lt;</span>goal<span style="color:#f92672">&gt;</span>report<span style="color:#f92672">&lt;/</span>goal<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;/</span>goals<span style="color:#f92672">&gt;</span>
                    <span style="color:#f92672">&lt;/</span>execution<span style="color:#f92672">&gt;</span>
                    <span style="color:#f92672">&lt;</span>execution<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;</span>id<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">default</span><span style="color:#f92672">-</span>check<span style="color:#f92672">&lt;/</span>id<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;</span>goals<span style="color:#f92672">&gt;</span>
                            <span style="color:#f92672">&lt;</span>goal<span style="color:#f92672">&gt;</span>check<span style="color:#f92672">&lt;/</span>goal<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;/</span>goals<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;</span>configuration<span style="color:#f92672">&gt;</span>
                            <span style="color:#f92672">&lt;</span>rules<span style="color:#f92672">&gt;</span>
                                <span style="color:#f92672">&lt;</span>rule<span style="color:#f92672">&gt;</span>
                                    <span style="color:#f92672">&lt;</span>element<span style="color:#f92672">&gt;</span>BUNDLE<span style="color:#f92672">&lt;/</span>element<span style="color:#f92672">&gt;</span>
                                    <span style="color:#f92672">&lt;</span>limits<span style="color:#f92672">&gt;</span>
                                        <span style="color:#f92672">&lt;</span>limit<span style="color:#f92672">&gt;</span>
                                            <span style="color:#f92672">&lt;</span>counter<span style="color:#f92672">&gt;</span>COMPLEXITY<span style="color:#f92672">&lt;/</span>counter<span style="color:#f92672">&gt;</span>
                                            <span style="color:#f92672">&lt;</span>value<span style="color:#f92672">&gt;</span>COVEREDRATIO<span style="color:#f92672">&lt;/</span>value<span style="color:#f92672">&gt;</span>
                                            <span style="color:#f92672">&lt;</span>minimum<span style="color:#f92672">&gt;</span>0<span style="color:#f92672">.</span><span style="color:#a6e22e">60</span><span style="color:#f92672">&lt;/</span>minimum<span style="color:#f92672">&gt;</span>
                                        <span style="color:#f92672">&lt;/</span>limit<span style="color:#f92672">&gt;</span>
                                    <span style="color:#f92672">&lt;/</span>limits<span style="color:#f92672">&gt;</span>
                                <span style="color:#f92672">&lt;/</span>rule<span style="color:#f92672">&gt;</span>
                            <span style="color:#f92672">&lt;/</span>rules<span style="color:#f92672">&gt;</span>
                        <span style="color:#f92672">&lt;/</span>configuration<span style="color:#f92672">&gt;</span>
                    <span style="color:#f92672">&lt;/</span>execution<span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;/</span>executions<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;/</span>plugin<span style="color:#f92672">&gt;</span>
</code></pre></div><ul>
<li>当使用lombok自动配置对象的builder的时候，jacoco是辨别不出来此为储存内容的对象，使得测试率下降。
<a href="https://medium.com/@mladen.bolic/lombok-data-improve-your-code-coverage-a74fb624a72b">https://medium.com/@mladen.bolic/lombok-data-improve-your-code-coverage-a74fb624a72b</a></li>
<li>
<ul>
<li><code>lombok.config</code>要放在根目录！（和pom.xml）一样的位置！</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#960050;background-color:#1e0010">#</span> lombok<span style="color:#f92672">.</span><span style="color:#a6e22e">config</span>
lombok<span style="color:#f92672">.</span><span style="color:#a6e22e">addLombokGeneratedAnnotation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</code></pre></div><h2 id="在github-actions中创建一个持续集成ci工作流以使用maven构建和测试java项目">在GitHub Actions中创建一个持续集成（CI）工作流，以使用Maven构建和测试Java项目</h2>
<p><a href="https://docs.github.com/en/actions/language-and-framework-guides/building-and-testing-java-with-maven">https://docs.github.com/en/actions/language-and-framework-guides/building-and-testing-java-with-maven</a></p>
<ul>
<li>新建一个目录<code>.github/workflows</code></li>
<li>在里面新建一个<code>maven.xml</code>文件（文件名可以任意取，但是后缀名统一为.yml）</li>
<li>复制</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  
<span style="color:#960050;background-color:#1e0010">#</span> This workflow will build a Java project with Maven
<span style="color:#960050;background-color:#1e0010">#</span> For more information see<span style="color:#f92672">:</span> https<span style="color:#f92672">:</span><span style="color:#75715e">//help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven
</span><span style="color:#75715e"></span>
name: Java CI with Maven

on:
  push<span style="color:#f92672">:</span>
    branches<span style="color:#f92672">:</span> <span style="color:#f92672">[</span> $default<span style="color:#f92672">-</span>branch <span style="color:#f92672">]</span>
  pull_request<span style="color:#f92672">:</span>
    branches<span style="color:#f92672">:</span> <span style="color:#f92672">[</span> $default<span style="color:#f92672">-</span>branch <span style="color:#f92672">]</span>

jobs:
  build<span style="color:#f92672">:</span>

    runs<span style="color:#f92672">-</span>on<span style="color:#f92672">:</span> ubuntu<span style="color:#f92672">-</span>latest

    steps:
    <span style="color:#f92672">-</span> uses<span style="color:#f92672">:</span> actions<span style="color:#f92672">/</span>checkout<span style="color:#a6e22e">@v2</span>
    <span style="color:#f92672">-</span> name<span style="color:#f92672">:</span> Set up JDK 1<span style="color:#f92672">.</span><span style="color:#a6e22e">8</span>
      uses<span style="color:#f92672">:</span> actions<span style="color:#f92672">/</span>setup<span style="color:#f92672">-</span>java<span style="color:#a6e22e">@v1</span>
      with<span style="color:#f92672">:</span>
        java<span style="color:#f92672">-</span>version<span style="color:#f92672">:</span> 1<span style="color:#f92672">.</span><span style="color:#a6e22e">8</span>
    <span style="color:#f92672">-</span> name<span style="color:#f92672">:</span> Build with Maven
      run<span style="color:#f92672">:</span> mvn <span style="color:#f92672">-</span>B <span style="color:#f92672">package</span> <span style="color:#960050;background-color:#1e0010">--</span>file pom<span style="color:#f92672">.</span><span style="color:#a6e22e">xml</span>
</code></pre></div><ul>
<li>
<ul>
<li>此工作流程执行以下步骤：</li>
</ul>
</li>
</ul>
<ol>
<li>该checkout步骤将在运行程序上下载存储库的副本。</li>
<li>该setup-java步骤配置Java 1.8 JDK。</li>
<li>“使用Maven进行构建”步骤package以非交互方式运行Maven 目标，以确保您的代码得以构建，通过测试并可以创建包。</li>
</ol>
<ul>
<li>
<ul>
<li>branches 一般都是master 或者是自己其他的branch(branch 名字写不对是识别不了Ci的，不要问为什么知道……)</li>
</ul>
</li>
<li>
<ul>
<li>maven run 的内容根据需要 ，一般都是 <code>mvn verify</code>做最后的检查</li>
</ul>
</li>
<li>
<p>spotbug 设置</p>
</li>
<li>
<ul>
<li>maven</li>
</ul>
</li>
</ul>
<h2 id="controller">Controller</h2>
<ul>
<li>Mapping</li>
<li>
<ul>
<li>路径里面添加变量</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RestController</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HelloController</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;greeting/{name}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">sayHello</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">)</span>String name<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">return</span> String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello,%s&#34;</span><span style="color:#f92672">,</span>name<span style="color:#f92672">);</span>

    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
http:<span style="color:#75715e">//127.0.0.1:8080/greeting/aa
</span><span style="color:#75715e"></span>效果:Hello<span style="color:#f92672">,</span>aa
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;greeting/&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">sayHello</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@RequestParam</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">)</span>String name<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">return</span> String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello,%s&#34;</span><span style="color:#f92672">,</span>name<span style="color:#f92672">);</span>

    <span style="color:#f92672">}</span>
http:<span style="color:#75715e">//127.0.0.1:8080/greeting?name=aa    
</span><span style="color:#75715e"></span>效果:Hello<span style="color:#f92672">,</span>aa
</code></pre></div><ul>
<li>通过Mapping里面表明来说明版本问题</li>
</ul>
<pre><code>@RequestMapping(&quot;v1/users&quot;)
public class UserController{

}
</code></pre><ul>
<li>Controller 使用的是Service 对象，因为是直接给前端的</li>
</ul>
<h2 id="使用swagger-创建api">使用Swagger 创建API</h2>
<ul>
<li>自动生成API文档，专门为SpringFamily</li>
<li>maven</li>
<li>
<ul>
<li><code>springfox-swagger2</code> 只是文档，没有可读性。Swagger UI:提供了一个可视化的UI页面展示描述文件。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#f92672">&lt;!--</span>Swagger<span style="color:#f92672">-</span>UI API doc generator<span style="color:#f92672">--&gt;</span>
        <span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>io<span style="color:#f92672">.</span><span style="color:#a6e22e">springfox</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>springfox<span style="color:#f92672">-</span>swagger2<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>version<span style="color:#f92672">&gt;</span>2<span style="color:#f92672">.</span><span style="color:#a6e22e">7</span><span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">&lt;/</span>version<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>io<span style="color:#f92672">.</span><span style="color:#a6e22e">springfox</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>springfox<span style="color:#f92672">-</span>swagger<span style="color:#f92672">-</span>ui<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>version<span style="color:#f92672">&gt;</span>2<span style="color:#f92672">.</span><span style="color:#a6e22e">7</span><span style="color:#f92672">.</span><span style="color:#a6e22e">0</span><span style="color:#f92672">&lt;/</span>version<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
</code></pre></div><ul>
<li>
<ul>
<li>配置 SpringFoxConfig</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
</code></pre></div><ul>
<li>
<ul>
<li>配置 ShiroConfig</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>swagger-ui、 swagger-ui的资源无论如何都要可以访问的</li>
<li>v2 web架构？</li>
</ul>
</blockquote>
<ul>
<li>
<ul>
<li>改善各个Controller 的注解</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>@Api</code>  value:对整个Controller进行描述</li>
<li><code>@ApiOperation</code> 对Controller 下的 接口进行描述（get、post、put……）<code>value</code>:写API描述，<code>resource</code>:写返回的类型</li>
<li><code>@ApiResponses</code>允许放status、message等，表现每个status表示什么问题</li>
</ul>
</blockquote>
<h2 id="shiro">shiro</h2>
<ul>
<li>是一个强大灵活的开源安全框架，可以完全处理身份验证、授权、加密和会话管理。</li>
</ul>
<blockquote>
<p>Authentication（认证）, Authorization（授权）, Session Management（会话管理）, Cryptography（加密）被 Shiro 框架的开发团队称之为应用安全的四大基石。</p>
<ul>
<li>Authentication（认证）：用户身份识别，通常被称为用户“登录”</li>
<li>Authorization（授权）：访问控制。比如某个用户是否具有某个操作的使用权限。</li>
<li>Session Management（会话管理）：特定于用户的会话管理,甚至在非web 或 EJB 应用程序。</li>
<li>Cryptography（加密）：在对数据源使用加密算法加密的同时，保证易于使用。</li>
</ul>
</blockquote>
<ul>
<li>在概念层，Shiro 架构包含三个主要的理念：Subject,SecurityManager和 Realm。</li>
</ul>
<blockquote>
<p>-Subject：当前用户，Subject 可以是一个人，但也可以是第三方服务、守护进程帐户、时钟守护任务或者其它–当前和软件交互的任何事件。</p>
<ul>
<li>SecurityManager：管理所有Subject，SecurityManager 是 Shiro 架构的核心，配合内部安全组件共同组成安全伞。</li>
<li>Realms：用于进行权限信息的验证，我们自己实现。Realm 本质上是一个特定的安全 DAO：它封装与数据源连接的细节，得到Shiro 所需的相关的数据。在配置 Shiro 的时候，你必须指定至少一个Realm 来实现认证（authentication）和/或授权（authorization）。
<a href="https://zhuanlan.zhihu.com/p/54176956">https://zhuanlan.zhihu.com/p/54176956</a></li>
</ul>
</blockquote>
<ul>
<li>Shiro 实现基本登录</li>
<li>
<ul>
<li>maven</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;!--</span> https<span style="color:#f92672">:</span><span style="color:#75715e">//mvnrepository.com/artifact/org.apache.shiro/shiro-spring --&gt;
</span><span style="color:#75715e"></span><span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">apache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">shiro</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>shiro<span style="color:#f92672">-</span>spring<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>version<span style="color:#f92672">&gt;</span>1<span style="color:#f92672">.</span><span style="color:#a6e22e">5</span><span style="color:#f92672">.</span><span style="color:#a6e22e">3</span><span style="color:#f92672">&lt;/</span>version<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
</code></pre></div><ul>
<li>
<ul>
<li>ShiroConfig</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>引入的<code>SecurityManager</code>的包一定是<code>import org.apache.shiro.mgt.SecurityManager;</code></li>
<li><code>SecurityManager</code>需要一个实现Realm（范围）接口的实例作为参数来用于获得AuthenticationInfo（用户信息）</li>
<li><code>ShiroFilter</code>拦截器</li>
</ul>
<blockquote>
<p>-Filter</p>
<ul>
<li>
<ul>
<li>判断请求是否合法，根据条件完成请求的处理，所有线程都结束工作或者timeout的话就执行<code>DESTORY</code></li>
</ul>
</li>
<li>
<ul>
<li>Filter Chain Eg:<code>request -&gt; f1 -&gt; f2 -&gt; handler -&gt; f3 -&gt;response</code></li>
</ul>
</li>
<li>
<ul>
<li>defalult Filture 可以看到权限的枚举</li>
</ul>
</li>
</ul>
</blockquote>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> javax.servlet<span style="color:#f92672">;</span>    
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">(</span>FilterConfig filterConfig<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{}</span>
   <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">(</span>FilterConfig filterConfig<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{}</span>
   <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#f92672">{}</span>
   <span style="color:#f92672">}</span>
<span style="color:#960050;background-color:#1e0010">```</span>java

<span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ShiroConfig</span> <span style="color:#f92672">{</span>
   <span style="color:#a6e22e">@Bean</span>
   <span style="color:#66d9ef">public</span> SecurityManager <span style="color:#a6e22e">securityManager</span><span style="color:#f92672">(</span>Realm realm<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
       <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> DefaultWebSecurityManager<span style="color:#f92672">(</span>realm<span style="color:#f92672">);</span>
   <span style="color:#f92672">}</span>

   <span style="color:#75715e">/**
</span><span style="color:#75715e">    * Shiro Filter,实现权限相关拦截
</span><span style="color:#75715e">    * &lt;p&gt;
</span><span style="color:#75715e">    * anon: Not need login access
</span><span style="color:#75715e">    * authc: required login ,and then access
</span><span style="color:#75715e">    * user: remember me -&gt; access
</span><span style="color:#75715e">    * role: role -&gt; access
</span><span style="color:#75715e">    */</span>

   <span style="color:#a6e22e">@Bean</span>
   <span style="color:#66d9ef">public</span> ShiroFilterFactoryBean <span style="color:#a6e22e">shiroFilterFactoryBean</span><span style="color:#f92672">(</span>SecurityManager securityManager<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
       val shiroFilterFactoryBean <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ShiroFilterFactoryBean<span style="color:#f92672">();</span>
       shiroFilterFactoryBean<span style="color:#f92672">.</span><span style="color:#a6e22e">setSecurityManager</span><span style="color:#f92672">(</span>securityManager<span style="color:#f92672">);</span>

       <span style="color:#75715e">//控制url用什么权限访问，常用LinkedHashMap
</span><span style="color:#75715e"></span>       val shiroFilterDefinitionMap <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedHashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;();</span>
       <span style="color:#75715e">//map需要顺序，因为有&#39;/**&#39;的设置，如果没有顺序，容易造成`/**`控制所有的页面，其他的权限控制无效的情况
</span><span style="color:#75715e"></span>
       shiroFilterDefinitionMap<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/v1.0/greeting&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;authc&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//需要登录才能访问
</span><span style="color:#75715e"></span>       shiroFilterDefinitionMap<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;v1.0/users/&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;anon&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//不需要登录就能访问
</span><span style="color:#75715e"></span>       shiroFilterDefinitionMap<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/**&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;authc&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//其他的页面需要登录才能够访问
</span><span style="color:#75715e"></span>
       shiroFilterFactoryBean<span style="color:#f92672">.</span><span style="color:#a6e22e">setFilterChainDefinitionMap</span><span style="color:#f92672">(</span>shiroFilterDefinitionMap<span style="color:#f92672">);</span>
       <span style="color:#66d9ef">return</span> shiroFilterFactoryBean<span style="color:#f92672">;</span>
   <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>Realm 实现 userRealm为例</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>@Component</code>使得<code>SecurityManager</code>能够识别</li>
<li>password 和 username 比较好的异常</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> UnknownAccountException<span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;The username %s was not found.&#34;</span><span style="color:#f92672">,</span>username<span style="color:#f92672">));</span>

 
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IncorrectCredentialsException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;The password is invalid for username %s.&#34;</span><span style="color:#f92672">)</span>
    
</code></pre></div><blockquote>
<ul>
<li>完成User 的认证</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> SimpleAuthenticationInfo<span style="color:#f92672">(</span>UserInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getUsername</span><span style="color:#f92672">,</span> password<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span> <span style="color:#75715e">//认证
</span></code></pre></div><p>···</p>
<ul>
<li>
<ul>
<li>SessionController</li>
</ul>
</li>
</ul>
<h2 id="密码加密">密码加密</h2>
<ul>
<li>密码不能明文传输，一定要加密</li>
<li>数据库要储存加密后的密码</li>
<li>
<ul>
<li>基本加密：MD5 SHA5 <code>EG：MD5(password) -&gt; newPassword -&gt; database</code></li>
</ul>
</li>
<li>
<ul>
<li>加盐加密 : <code>EG: MD5(password + salt) -&gt; newPassword -&gt; database</code></li>
</ul>
</li>
<li>
<ul>
<li>多次迭代加盐加密</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Round 1 
<span style="color:#a6e22e">MD5</span><span style="color:#f92672">(</span>password <span style="color:#f92672">+</span> salt<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> newPassword_1 
Round 2
<span style="color:#a6e22e">MD5</span><span style="color:#f92672">(</span>newPassword_1 <span style="color:#f92672">+</span> salt<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> newPassword_2
<span style="color:#960050;background-color:#1e0010">……</span>
MD5<span style="color:#f92672">(</span>newPassword_n<span style="color:#f92672">-</span>1 <span style="color:#f92672">+</span> salt<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> newPassword_n <span style="color:#f92672">-&gt;</span> database
</code></pre></div><ul>
<li>数据库加密版数据库……</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">create</span> <span style="color:#a6e22e">table</span> <span style="color:#e6db74">`accounting_userinfo`</span>(
<span style="color:#e6db74">`id`</span> <span style="color:#a6e22e">bigint</span>(<span style="color:#ae81ff">20</span>) <span style="color:#a6e22e">unsigned</span> <span style="color:#a6e22e">NOT</span> <span style="color:#a6e22e">NULL</span> <span style="color:#a6e22e">AUTO_INCREMENT</span>,
<span style="color:#e6db74">`username`</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">64</span>) <span style="color:#a6e22e">NOT</span> <span style="color:#a6e22e">NULL</span> <span style="color:#a6e22e">COMMENT</span> <span style="color:#e6db74">&#39;user name&#39;</span>,
<span style="color:#e6db74">`password`</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">64</span>) <span style="color:#a6e22e">NOT</span> <span style="color:#a6e22e">NULL</span>,
<span style="color:#e6db74">`salt`</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">50</span>) <span style="color:#a6e22e">NOT</span> <span style="color:#a6e22e">NULL</span>,
<span style="color:#e6db74">`create_time`</span> <span style="color:#a6e22e">datetime</span>,
<span style="color:#e6db74">`update_time`</span> <span style="color:#a6e22e">datetime</span> <span style="color:#a6e22e">DEFAULT</span> <span style="color:#a6e22e">NULL</span> <span style="color:#a6e22e">ON</span> <span style="color:#a6e22e">UPDATE</span> <span style="color:#a6e22e">CURRENT_TIMESTAMP</span>,
<span style="color:#a6e22e">PRIMARY</span> <span style="color:#a6e22e">KEY</span> <span style="color:#e6db74">`pk_id`</span>(<span style="color:#e6db74">`id`</span>),
<span style="color:#a6e22e">UNIQUE</span> <span style="color:#a6e22e">KEY</span> <span style="color:#e6db74">`uk_username`</span>(<span style="color:#e6db74">`username`</span>)
)
<span style="color:#a6e22e">ENGINE</span><span style="color:#f92672">=</span><span style="color:#a6e22e">InnoDB</span> <span style="color:#a6e22e">AUTO_INCREMENT</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#a6e22e">DEFAULT</span> <span style="color:#a6e22e">CHARSET</span><span style="color:#f92672">=</span><span style="color:#a6e22e">utf8</span>;
</code></pre></div><ul>
<li>在manager 处加盐</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> UserInfo <span style="color:#a6e22e">register</span><span style="color:#f92672">(</span>String username<span style="color:#f92672">,</span> String password<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        val userInfo  <span style="color:#f92672">=</span> userInfoDao<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUsername</span><span style="color:#f92672">(</span>username<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>userInfo <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InvalidParameterException<span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;The user %s was registered.&#34;</span><span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// Set random salt
</span><span style="color:#75715e"></span>        String salt <span style="color:#f92672">=</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
        String encryptedPassword <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Sha256Hash<span style="color:#f92672">(</span>password<span style="color:#f92672">,</span>salt<span style="color:#f92672">,</span> HASH_ITERATIONS<span style="color:#f92672">).</span><span style="color:#a6e22e">toBase64</span><span style="color:#f92672">();</span>
        val newUserInfo <span style="color:#f92672">=</span> com<span style="color:#f92672">.</span><span style="color:#a6e22e">procarihana</span><span style="color:#f92672">.</span><span style="color:#a6e22e">accounting</span><span style="color:#f92672">.</span><span style="color:#a6e22e">moudle</span><span style="color:#f92672">.</span><span style="color:#a6e22e">presistence</span><span style="color:#f92672">.</span><span style="color:#a6e22e">UserInfo</span><span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">username</span><span style="color:#f92672">(</span>username<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">password</span><span style="color:#f92672">(</span>encryptedPassword<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">salt</span><span style="color:#f92672">(</span>salt<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">createTime</span><span style="color:#f92672">(</span>LocalDateTime<span style="color:#f92672">.</span><span style="color:#a6e22e">now</span><span style="color:#f92672">())</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">updateTime</span><span style="color:#f92672">(</span>LocalDateTime<span style="color:#f92672">.</span><span style="color:#a6e22e">now</span><span style="color:#f92672">())</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
        userInfoDao<span style="color:#f92672">.</span><span style="color:#a6e22e">createNewUser</span><span style="color:#f92672">(</span>newUserInfo<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> userInfoPresToComConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>newUserInfo<span style="color:#f92672">);</span>

    <span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>用户认证的时候需要带上<code>salt</code>来进行密码的认证，所以要在<code>UserReaml</code>处认证的时候后也要带上<code>salt</code></li>
<li>
<ul>
<li>在<code>AuthenticationInfo</code>进行认证的时候后，需要<code>salt</code>的参数为BySource 。String -&gt; ByteSouce ==&gt; ByteSource.Uyil.bytes(stirng)完成,要注意引用的类。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> org.apache.shiro.util.ByteSource<span style="color:#f92672">;</span>

 <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> AuthenticationInfo <span style="color:#a6e22e">doGetAuthenticationInfo</span><span style="color:#f92672">(</span>AuthenticationToken token<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> AuthenticationException <span style="color:#f92672">{</span>
        String username <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>String<span style="color:#f92672">)</span> token<span style="color:#f92672">.</span><span style="color:#a6e22e">getPrincipal</span><span style="color:#f92672">();</span> <span style="color:#75715e">//主项
</span><span style="color:#75715e"></span>        String password <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">((</span><span style="color:#66d9ef">char</span><span style="color:#f92672">[])</span> token<span style="color:#f92672">.</span><span style="color:#a6e22e">getCredentials</span><span style="color:#f92672">());</span> <span style="color:#75715e">//凭证
</span><span style="color:#75715e"></span>        val userInfo <span style="color:#f92672">=</span> userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUsername</span><span style="color:#f92672">(</span>username<span style="color:#f92672">);</span>
        val salt <span style="color:#f92672">=</span> ByteSource<span style="color:#f92672">.</span><span style="color:#a6e22e">Util</span><span style="color:#f92672">.</span><span style="color:#a6e22e">bytes</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getSalt</span><span style="color:#f92672">());</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> SimpleAuthenticationInfo<span style="color:#f92672">(</span>userInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getUsername</span><span style="color:#f92672">(),</span> userInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">(),</span> salt<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span> <span style="color:#75715e">//认证
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</code></pre></div><h2 id="tag">Tag</h2>
<ul>
<li>table</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">create table <span style="color:#960050;background-color:#1e0010">`</span>accounting_tag<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">(</span>
   <span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span>          bigint<span style="color:#f92672">(</span>20<span style="color:#f92672">)</span> unsigned NOT NULL AUTO_INCREMENT<span style="color:#f92672">,</span>
    <span style="color:#960050;background-color:#1e0010">`</span>description<span style="color:#960050;background-color:#1e0010">`</span> varchar<span style="color:#f92672">(</span>50<span style="color:#f92672">)</span>         NOT NULL<span style="color:#f92672">,</span>
    <span style="color:#960050;background-color:#1e0010">`</span>user_id<span style="color:#960050;background-color:#1e0010">`</span>     bigint<span style="color:#f92672">(</span>20<span style="color:#f92672">)</span> unsigned NOT NULL<span style="color:#f92672">,</span>
    <span style="color:#960050;background-color:#1e0010">`</span>status<span style="color:#960050;background-color:#1e0010">`</span>      tinyint<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span> unsigned NOT NULL COMMENT <span style="color:#960050;background-color:#1e0010">&#39;</span>0<span style="color:#f92672">-&gt;</span> disabled<span style="color:#f92672">,</span> 1<span style="color:#f92672">-&gt;</span> enabled<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span>
    <span style="color:#960050;background-color:#1e0010">`</span>create_time<span style="color:#960050;background-color:#1e0010">`</span> datetime NOT NULL DEFAULT CURRENT_TIMESTAMP<span style="color:#f92672">,</span>
    <span style="color:#960050;background-color:#1e0010">`</span>update_time<span style="color:#960050;background-color:#1e0010">`</span> datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP<span style="color:#f92672">,</span>
    PRIMARY KEY <span style="color:#960050;background-color:#1e0010">`</span>pk_id<span style="color:#960050;background-color:#1e0010">`</span> <span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">),</span>
    KEY <span style="color:#960050;background-color:#1e0010">`</span>idx_uid<span style="color:#960050;background-color:#1e0010">`</span> <span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">`</span>user_id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">),</span>
    FOREIGN <span style="color:#a6e22e">KEY</span> <span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">`</span>user_id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">)</span> REFERENCES <span style="color:#a6e22e">hcas_userinfo</span> <span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">)</span>
<span style="color:#f92672">)</span>
ENGINE<span style="color:#f92672">=</span>InnoDB AUTO_INCREMENT<span style="color:#f92672">=</span>1 DEFAULT CHARSET<span style="color:#f92672">=</span>utf8<span style="color:#f92672">;</span>
</code></pre></div><ul>
<li>
<ul>
<li>foreigen key 是其他表属性的映射</li>
</ul>
</li>
<li>
<ul>
<li>status用0和1表示的话用<code>tinyint（1)</code></li>
</ul>
</li>
</ul>
<h2 id="record">Record</h2>
<ul>
<li>table</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">create table <span style="color:#960050;background-color:#1e0010">`</span>accounting_record<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">(</span>
<span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span> bigint<span style="color:#f92672">(</span>20<span style="color:#f92672">)</span> unsigned NOT NULL AUTO_INCREMENT<span style="color:#f92672">,</span> 
<span style="color:#960050;background-color:#1e0010">`</span>amount<span style="color:#960050;background-color:#1e0010">`</span> decimal<span style="color:#f92672">(</span>18<span style="color:#f92672">,</span>2<span style="color:#f92672">)</span> NOT NULL DEFAULT<span style="color:#960050;background-color:#1e0010">&#39;</span>0<span style="color:#f92672">.</span><span style="color:#a6e22e">00</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span> 
<span style="color:#960050;background-color:#1e0010">`</span>note<span style="color:#960050;background-color:#1e0010">`</span> varchar<span style="color:#f92672">(</span>200<span style="color:#f92672">)</span> DEFAULT NULL<span style="color:#f92672">,</span> 
<span style="color:#960050;background-color:#1e0010">`</span>category<span style="color:#960050;background-color:#1e0010">`</span> tinyint<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span> unsigned NOT NULL COMMENT<span style="color:#960050;background-color:#1e0010">&#39;</span>0<span style="color:#f92672">-&gt;</span> outcome<span style="color:#f92672">,</span> 1<span style="color:#f92672">-&gt;</span> income<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span> 
<span style="color:#960050;background-color:#1e0010">`</span>status<span style="color:#960050;background-color:#1e0010">`</span> tinyint<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span> unsigned NOT NULL COMMENT<span style="color:#960050;background-color:#1e0010">&#39;</span>0<span style="color:#f92672">-&gt;</span> disable<span style="color:#f92672">,</span> 1<span style="color:#f92672">-&gt;</span> enable<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span> 
<span style="color:#960050;background-color:#1e0010">`</span>create_time<span style="color:#960050;background-color:#1e0010">`</span> datetime NOT NULL DEFAULT CURRENT_TIMESTAMP<span style="color:#f92672">,</span> 
<span style="color:#960050;background-color:#1e0010">`</span>update_time<span style="color:#960050;background-color:#1e0010">`</span> datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP<span style="color:#f92672">,</span> 
<span style="color:#960050;background-color:#1e0010">`</span>user_id<span style="color:#960050;background-color:#1e0010">`</span> bigint<span style="color:#f92672">(</span>20<span style="color:#f92672">)</span> unsigned NOT NULL<span style="color:#f92672">,</span>
PRIMARY KEY <span style="color:#960050;background-color:#1e0010">`</span>pk_id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">),</span> 
KEY <span style="color:#960050;background-color:#1e0010">`</span>user_key<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">`</span>user_id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">),</span> 
FOREIGN <span style="color:#a6e22e">KEY</span> <span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">`</span>user_id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">)</span> REFERENCES <span style="color:#a6e22e">accounting_userinfo</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">)</span>
<span style="color:#f92672">)</span> ENGINE<span style="color:#f92672">=</span>InnoDB AUTO_INCREMENT<span style="color:#f92672">=</span>1 DEFAULT CHARSET<span style="color:#f92672">=</span>utf8<span style="color:#f92672">;</span> 
</code></pre></div><h2 id="dao">DAO</h2>
<ul>
<li><code>@Repository</code>来表示数据库，用于封装存储的</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> org.springframework.stereotype.Repository<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@Repository</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoDaoImpl</span> <span style="color:#66d9ef">implements</span> UserInfoDao<span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> UserInfo <span style="color:#a6e22e">getUserInfoById</span><span style="color:#f92672">(</span>Long id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><ul>
<li>Dao 使用的是prisistence对象</li>
</ul>
<h2 id="manager">Manager</h2>
<ul>
<li>manager部分使用的是common的对象</li>
<li>manager 需要向数据库转换，也需要向Controller转换，可以直接通过converter完成</li>
</ul>
<h2 id="converter">Converter</h2>
<ul>
<li>通过继承<code>Converter</code>方法来完成类型的转换 (Guava maven)
Eg</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.Procarihana.AccountingService.converter.presisitenceToCommon<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.Procarihana.AccountingService.Moudle.presistence.UserInfo<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.google.common.base.Converter<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.time.LocalDate<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoConverter</span> <span style="color:#66d9ef">extends</span> Converter<span style="color:#f92672">&lt;</span>UserInfo<span style="color:#f92672">,</span> com<span style="color:#f92672">.</span><span style="color:#a6e22e">Procarihana</span><span style="color:#f92672">.</span><span style="color:#a6e22e">AccountingService</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Moudle</span><span style="color:#f92672">.</span><span style="color:#a6e22e">common</span><span style="color:#f92672">.</span><span style="color:#a6e22e">UserInfo</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> com<span style="color:#f92672">.</span><span style="color:#a6e22e">Procarihana</span><span style="color:#f92672">.</span><span style="color:#a6e22e">AccountingService</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Moudle</span><span style="color:#f92672">.</span><span style="color:#a6e22e">common</span><span style="color:#f92672">.</span><span style="color:#a6e22e">UserInfo</span> <span style="color:#a6e22e">doForward</span><span style="color:#f92672">(</span>UserInfo userInfo<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> com<span style="color:#f92672">.</span><span style="color:#a6e22e">Procarihana</span><span style="color:#f92672">.</span><span style="color:#a6e22e">AccountingService</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Moudle</span><span style="color:#f92672">.</span><span style="color:#a6e22e">common</span><span style="color:#f92672">.</span><span style="color:#a6e22e">UserInfo</span><span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">username</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getUsername</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">password</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> UserInfo <span style="color:#a6e22e">doBackward</span><span style="color:#f92672">(</span>com<span style="color:#f92672">.</span><span style="color:#a6e22e">Procarihana</span><span style="color:#f92672">.</span><span style="color:#a6e22e">AccountingService</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Moudle</span><span style="color:#f92672">.</span><span style="color:#a6e22e">common</span><span style="color:#f92672">.</span><span style="color:#a6e22e">UserInfo</span> userInfo<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> UserInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">createTime</span><span style="color:#f92672">(</span>LocalDate<span style="color:#f92672">.</span><span style="color:#a6e22e">now</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">updateTime</span><span style="color:#f92672">(</span>LocalDate<span style="color:#f92672">.</span><span style="color:#a6e22e">now</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">password</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">username</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getUsername</span><span style="color:#f92672">())</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.Procarihana.AccountingService.Manager<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.Procarihana.AccountingService.Dao.UserInfoDao<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.Procarihana.AccountingService.Moudle.common.UserInfo<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.Procarihana.AccountingService.converter.presisitenceToCommon.UserInfoConverter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.stereotype.Component<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@Component</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoManagerImpl</span> <span style="color:#66d9ef">implements</span> UserInfoManager <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> UserInfoDao userInfoDao<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> UserInfoConverter userInfoConverter<span style="color:#f92672">;</span>
    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">UserInfoManagerImpl</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> UserInfoDao userInfoDao<span style="color:#f92672">,</span>
                               <span style="color:#66d9ef">final</span> UserInfoConverter userInfoConverter<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">userInfoDao</span> <span style="color:#f92672">=</span> userInfoDao<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">userInfoConverter</span> <span style="color:#f92672">=</span> userInfoConverter<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> UserInfo <span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>Long userId<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        com<span style="color:#f92672">.</span><span style="color:#a6e22e">Procarihana</span><span style="color:#f92672">.</span><span style="color:#a6e22e">AccountingService</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Moudle</span><span style="color:#f92672">.</span><span style="color:#a6e22e">presistence</span><span style="color:#f92672">.</span><span style="color:#a6e22e">UserInfo</span> userInfo <span style="color:#f92672">=</span> userInfoDao<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoById</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">);</span>
        UserInfo commonUserInfo <span style="color:#f92672">=</span> userInfoConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">);</span>  
        <span style="color:#66d9ef">return</span> userInfoConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>userInfo<span style="color:#f92672">);</span>


    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//翻转
</span><span style="color:#75715e"></span>    com<span style="color:#f92672">.</span><span style="color:#a6e22e">Procarihana</span><span style="color:#f92672">.</span><span style="color:#a6e22e">AccountingService</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Moudle</span><span style="color:#f92672">.</span><span style="color:#a6e22e">presistence</span><span style="color:#f92672">.</span><span style="color:#a6e22e">UserInfo</span> userInfo1 <span style="color:#f92672">=</span> userInfoConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">reverse</span><span style="color:#f92672">().</span><span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>commonUserInfo<span style="color:#f92672">);</span> 
</code></pre></div><ul>
<li>
<ul>
<li>doBaceWard 的时候，需要根据实际情况选择是否能够转换，转换的内容为空的时候应该如何处理等</li>
</ul>
</li>
<li>转换不能调用Service、io等操作</li>
</ul>
<h2 id="mark-little-point">Mark Little Point</h2>
<ol>
<li><code>%s</code>&ndash;&gt; 字符串类型</li>
<li>LocalDatetime vs Instant</li>
</ol>
<ul>
<li>LocalDateTime对于用户来说，可能就只是一个简单的日期和时间的概念，考虑如下的例子：两个人都在2013年7月2日11点出生，第一个人是在英国出生，而第二个是在加尼福利亚，如果我们问他们是在什么时候出生的话，则他们看上去都是 在同样的时间出生（就是LocalDateTime所表达的），
但如果我们根据时间线（如格林威治时间线）去仔细考察，则会发现在出生的人会比在英国出生的人稍微晚几个小时（这就是Instant所表达的概念，并且要将其转换为UTC格式的时间）。</li>
</ul>
<ol start="3">
<li>添加<code>projectlombok maven</code>加上注解能够自动进行对象的getter和setter,builder模式等等</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        <span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">projectlombok</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>lombok<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>version<span style="color:#f92672">&gt;</span>1<span style="color:#f92672">.</span><span style="color:#a6e22e">18</span><span style="color:#f92672">.</span><span style="color:#a6e22e">12</span><span style="color:#f92672">&lt;/</span>version<span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;</span>scope<span style="color:#f92672">&gt;</span>provided<span style="color:#f92672">&lt;/</span>scope<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.Procarihana.AccountingService.Moudle.presistence<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.Builder<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.Data<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@Data</span>
<span style="color:#a6e22e">@Builder</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInformation</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Long id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String username<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String password<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> LocalDate createTime<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> LocalDate  updateTime<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li><code>val</code> 能够自动识别对象的类型 (需要在IDE下载Lombok的plugin，并且把设置都选上才能正常使用)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        com<span style="color:#f92672">.</span><span style="color:#a6e22e">Procarihana</span><span style="color:#f92672">.</span><span style="color:#a6e22e">AccountingService</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Moudle</span><span style="color:#f92672">.</span><span style="color:#a6e22e">common</span><span style="color:#f92672">.</span><span style="color:#a6e22e">UserInfo</span> userInfo <span style="color:#f92672">=</span> userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">);</span>
        <span style="color:#f92672">==&gt;</span>
        val userInfo <span style="color:#f92672">=</span> userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">);</span>

val userInfo <span style="color:#f92672">==&gt;</span>  com<span style="color:#f92672">.</span><span style="color:#a6e22e">Procarihana</span><span style="color:#f92672">.</span><span style="color:#a6e22e">AccountingService</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Moudle</span><span style="color:#f92672">.</span><span style="color:#a6e22e">common</span><span style="color:#f92672">.</span><span style="color:#a6e22e">UserInfo</span> userInfo <span style="color:#f92672">=</span> userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">);</span>
 userInfo
</code></pre></div><ul>
<li><code>@Slf4j</code></li>
</ul>
<pre><code>import lombok.extern.slf4j.Slf4j;

@Slf4j
@RestController
public class UserController {
log.info(&quot;Get user info by user id {}&quot;,userId);
}
</code></pre><ul>
<li><code>@NoArgsConstructor``@AllArgsConstructor</code>设置构造器无参数或者全参数，</li>
</ul>
<ol start="4">
<li><code>@RestController</code>  Vs <code>@Controller</code></li>
</ol>
<ul>
<li>@RestController注解相当于@ResponseBody ＋ @Controller合在一起的作用。
RestController使用的效果是将方法返回的对象直接在浏览器上展示成json格式，而如果单单使用@Controller会报错，需要ResponseBody配合使用。</li>
<li>如果只是使用@RestController注解Controller类，则方法无法返回jsp页面，配置的视图解析器InternalResourceViewResolver不起作用，返回的内容就是Return 里的内容。
例如：本来应该到success.jsp页面的，则其显示success.</li>
<li>如果需要返回到指定页面，则需要用 @Controller配合视图解析器InternalResourceViewResolver才行。</li>
<li>如果需要返回JSON，XML或自定义mediaType内容到页面，则需要在对应的方法上加上@ResponseBody注解。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Controller</span>  
<span style="color:#a6e22e">@ResponseBody</span>  
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyController</span> <span style="color:#f92672">{</span>

 <span style="color:#f92672">}</span>  

或者在方法上加<span style="color:#a6e22e">@ResponseBody</span>  
<span style="color:#a6e22e">@Controller</span>  
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyController</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@ResponseBody</span>
    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/sutdent&#34;</span><span style="color:#f92672">,</span> method <span style="color:#f92672">=</span> RequestMethod<span style="color:#f92672">.</span><span style="color:#a6e22e">GET</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> Student <span style="color:#a6e22e">uploadFile</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    
    <span style="color:#f92672">}</span>
 <span style="color:#f92672">}</span>  
  
<span style="color:#a6e22e">@RestController</span>  
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyRestController</span> <span style="color:#f92672">{</span> <span style="color:#f92672">}</span>  
</code></pre></div><p>链接：https://www.jianshu.com/p/</p>
<ol start="5">
<li>Guava</li>
</ol>
<ul>
<li>Converter</li>
</ul>
<ol start="6">
<li>解决同名不同包的区分
通过<code>@Qualifier</code>注解来提醒？？？？？？？？？？？？？</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Qualifier<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoManagerImpl</span> <span style="color:#66d9ef">implements</span> UserInfoManager <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> UserInfoDao userInfoDao<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">UserInfoManagerImpl</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Qualifier</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UserInfoMysqlDao&#34;</span><span style="color:#f92672">)</span> UserInfoDao userInfoDao<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">userInfoDao</span> <span style="color:#f92672">=</span> userInfoDao<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

</code></pre></div><ol start="6">
<li>整个项目的框架是SpringBoot框架搭建的，而Mapper这个类是用Mybatis-SpringBoot-start构建起来的，所以<code>@Autowired</code>不一定能够识别出来，mapper实例可能会出现没有Bean的情况，虽然这种情况下可以编译动过，运行也没有问题，但是还是会报错。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Repository</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoDaoImpl</span> <span style="color:#66d9ef">implements</span> UserInfoDao<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> UserInfoMapper userInfoMapper<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">UserInfoDaoImpl</span><span style="color:#f92672">(</span>UserInfoMapper userInfoMapper<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">userInfoMapper</span> <span style="color:#f92672">=</span> userInfoMapper<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>==&gt;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> lombok.RequiredArgsConstructor<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@Repository</span>
<span style="color:#a6e22e">@RequiredArgsConstructor</span><span style="color:#f92672">(</span>onConstructor <span style="color:#f92672">=</span> <span style="color:#a6e22e">@__</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Autowired</span><span style="color:#f92672">))</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoDaoImpl</span> <span style="color:#66d9ef">implements</span> UserInfoDao<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> UserInfoMapper userInfoMapper<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><ol start="7">
<li><code>Optional</code></li>
<li><code>enum</code></li>
<li><code>@ExtendWith </code>is a repeatable annotation that is used to register extensions for the annotated test class or test method.</li>
</ol>
<ul>
<li>是一个可重复的注释，用于为已注释的测试类或测试方法注册扩展。</li>
<li>
<ul>
<li>在Mockito 添加后就可以不用添加<code>MockitoAnnotionals </code>, 可以自动生成一个测试对象，不需要额外new出来</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoDaoTest</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Mock</span>
    <span style="color:#66d9ef">private</span> UserInfoMapper userInfoMapper<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> UserInfoDao userInfoDao<span style="color:#f92672">;</span>

   <span style="color:#a6e22e">@BeforeEach</span>
   <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span><span style="color:#f92672">(){</span>
       MockitoAnnotations<span style="color:#f92672">.</span><span style="color:#a6e22e">initMocks</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
       userInfoDao <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UserInfoDaoImpl<span style="color:#f92672">(</span>userInfoMapper<span style="color:#f92672">);</span>
   <span style="color:#f92672">}</span>
</code></pre></div><p>==&gt;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@ExtendWith</span><span style="color:#f92672">(</span>MockitoExtension<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserInfoDaoTest</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Mock</span>
    <span style="color:#66d9ef">private</span> UserInfoMapper userInfoMapper<span style="color:#f92672">;</span>
    <span style="color:#a6e22e">@InjectMocks</span>
    <span style="color:#66d9ef">private</span> UserInfoDaoImpl userInfoDao<span style="color:#f92672">;</span>
</code></pre></div><ol start="10">
<li>@标签应有非空说明。&ndash;&gt; <code>&lt;b&gt;must not&lt;/b&gt; be null</code></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#f92672">*</span> <span style="color:#a6e22e">@param</span> userInfoCToSeConverter <span style="color:#f92672">;</span> <span style="color:#f92672">&lt;</span>b<span style="color:#f92672">&gt;</span>must not<span style="color:#f92672">&lt;/</span>b<span style="color:#f92672">&gt;</span> be <span style="color:#66d9ef">null</span>
</code></pre></div><ol start="11">
<li>SpringIoc（控制翻转）和DI（依赖注入）</li>
</ol>
<ul>
<li><a href="https://www.cnblogs.com/xdp-gacl/p/4249939.html">https://www.cnblogs.com/xdp-gacl/p/4249939.html</a></li>
</ul>
<ol start="12">
<li>SQL 和 NoSQL</li>
</ol>
<ul>
<li>是否需要支持Transaction：NOSQL Transaction支持有限，实现麻烦</li>
<li>是否会有丰富的QueryBuilder</li>
<li>对TPS 要求是否高？是否需要很好的可拓展性</li>
<li>花式查询（Query Builder）：根据多种条件进行同时的查询，SQL就能够很好地支持（Eg：根据多个tag查询数据）</li>
<li>TBS:可拓展性 Nosql比Mysql要强</li>
<li>
<ul>
<li>Mysql ：通过读和写请求分开处理的负载分库分库分表查询的时候后就难以查询通过负载均衡的请求，使得TBS比较低</li>
</ul>
</li>
<li>
<ul>
<li>Nosql 对强一致性不友好，update后不一定能马上改，而修改的时间也不可预测</li>
</ul>
</li>
</ul>
<h2 id="业务框架">业务框架</h2>
<ul>
<li>服务的边界，核心。罗列出所有的功能，然后选出核心功能MVP。</li>
<li>
<ul>
<li>UserManager、RecordManager、TagManager</li>
</ul>
</li>
<li>
<ul>
<li>微服务架构会通过Service来构建逻辑，而组建则会通过Manager完成</li>
</ul>
</li>
<li>完成记账业务</li>
</ul>
<ol>
<li>只用一个record表完成记账。用户删除数据的时候会改变数据的status，并不会真正地删除，会出现用户检索到已经删除的数据但是不能查看的情况。每一次更新都需要把tags全部更新，检索顺序可能会出现问题。</li>
<li>用record 和tags 完成记录。</li>
</ol>
<ul>
<li>
<ul>
<li>record 包含 recordid、userid、支出收入（amount）、备注等</li>
</ul>
</li>
<li>
<ul>
<li>tags 包含tagid、userid、recordid、tag描述</li>
</ul>
</li>
<li>
<ul>
<li>record 会对应多个tag，就会出现一个record被多个tag多次储存的情况，导致数据冗余</li>
</ul>
</li>
</ul>
<ol start="3">
<li>使用三个表完成（通过中间表完成）。record、record-tag-mapping、tags</li>
</ol>
<ul>
<li>
<ul>
<li>record 和tags 分别储存各自的信息，在map里面储存record对应的各个tag。</li>
</ul>
</li>
<li>测试</li>
<li>
<ul>
<li>单元测试</li>
</ul>
</li>
<li>
<ul>
<li>集成测试</li>
</ul>
</li>
<li>
<ul>
<li>性能测试</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>在controller 里 把传入的数据都要过滤，减少非法数据进入数据库查询</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@PutMapping</span><span style="color:#f92672">(</span>path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/{id}&#34;</span><span style="color:#f92672">,</span> consumes <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;application/json&#34;</span><span style="color:#f92672">,</span> produces <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;application/json&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> Tag <span style="color:#a6e22e">updateTag</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span> Long tagId<span style="color:#f92672">,</span> <span style="color:#a6e22e">@RequestBody</span> Tag tag<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        String status <span style="color:#f92672">=</span> tag<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatus</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>status <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#e6db74">&#34;ENABLE&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>status<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#e6db74">&#34;DISABLE&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>status<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InvalidParameterException<span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;The status [%s] to update is invalid status&#34;</span><span style="color:#f92672">,</span> status<span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>tag<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserId</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> tag<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserId</span><span style="color:#f92672">()</span> <span style="color:#f92672">&lt;=</span> 0L<span style="color:#f92672">){</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InvalidParameterException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;The user id is empty or invalid&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>tagId <span style="color:#f92672">==</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> tagId <span style="color:#f92672">&lt;=</span> 0L<span style="color:#f92672">){</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InvalidParameterException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;The tag id is empty or invalid&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        userInfoManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserInfoByUserID</span><span style="color:#f92672">(</span>tag<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserId</span><span style="color:#f92672">());</span>
        tag<span style="color:#f92672">.</span><span style="color:#a6e22e">setId</span><span style="color:#f92672">(</span>tagId<span style="color:#f92672">);</span>

        val tagInC <span style="color:#f92672">=</span> tagC2SConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">reverse</span><span style="color:#f92672">().</span><span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>tag<span style="color:#f92672">);</span>
        val newTag <span style="color:#f92672">=</span> tagManager<span style="color:#f92672">.</span><span style="color:#a6e22e">updateTag</span><span style="color:#f92672">(</span>tagInC<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> tagC2SConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">convert</span><span style="color:#f92672">(</span>newTag<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>BUD测试</li>
</ul>
</li>
<li>检测报警</li>
<li>
<ul>
<li>系统性能监控</li>
</ul>
</li>
<li>
<ul>
<li>error、latency</li>
</ul>
</li>
<li>
<ul>
<li>业务层面监控</li>
</ul>
</li>
<li>部署与发布</li>
<li>
<ul>
<li>金丝雀发布。逐个服务进行发布，一步步测试是能够成功</li>
</ul>
</li>
</ul>
<h4 id="记账服务模块">记账服务模块</h4>
<ul>
<li>
<p>Record</p>
</li>
<li>
<ul>
<li>记录一笔账单交易 creatNewRecordByRecordId</li>
</ul>
</li>
<li>
<ul>
<li>编辑单条账单记录 updateRecordByRecordId</li>
</ul>
</li>
<li>
<ul>
<li>删除单挑账单记录 deleteRecordByRecordId</li>
</ul>
</li>
<li>
<ul>
<li>查询单挑账单记录 getRecordByRecordlId</li>
</ul>
</li>
<li>
<ul>
<li>按条件查询账单记录（会不会涉及到分页）</li>
</ul>
</li>
<li>
<p>Tag</p>
</li>
<li>
<ul>
<li>列出用户所有标签 listAllTagsByUserId</li>
</ul>
</li>
<li>
<ul>
<li>新增标签 createNewTagForUserId</li>
</ul>
</li>
<li>
<ul>
<li>编辑已有标签 updateTagBytagId</li>
</ul>
</li>
<li>
<ul>
<li>删除已有标签 deleteTagByTagId</li>
</ul>
</li>
<li>
<p>用户用例图 -&gt;UML</p>
</li>
<li>
<ul>
<li>用例：用户能够使用的服务，扩展用例则是实现这些服务的手段，或者是相关的子服务，主要看是什么关系（include、extend）</li>
</ul>
</li>
<li>
<p>分页和流水分页</p>
</li>
<li>
<ul>
<li>pageSize</li>
</ul>
</li>
<li>
<ul>
<li>pageNumber</li>
</ul>
</li>
<li>
<ul>
<li>cursor -&gt; 游标：从第几页开始查看</li>
</ul>
</li>
<li>
<p>贫血模型和充血模型</p>
</li>
<li>
<ul>
<li>充血模型会把相应的接口方法直接放在moudel里，但是一般都会用贫血模型，相应的业务会分开处理和存放</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//贫血模型
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> calss <span style="color:#a6e22e">UserInfo</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">private</span> Long userId<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String username<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String password<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> calss <span style="color:#a6e22e">UserInfo</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">private</span> Long userId<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String username<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String password<span style="color:#f92672">;</span>
    
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">updateUserInfoByUserId</span><span style="color:#f92672">()</span><span style="color:#960050;background-color:#1e0010">；</span>

    UserInfo <span style="color:#a6e22e">getuserInfoByUserId</span><span style="color:#f92672">();</span> 
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li><code>@Request</code>改善数据库和实例moudle的变量名不同一或者嵌套等情况造成的映射失败、不完全映射的情况</li>
<li>
<ul>
<li><code>@One``@Many</code>一对以一或者一对多。Eg：一个文章里面有多个Tag,就需要<code>@Many</code></li>
</ul>
</li>
<li>converter 转换的时候，status要注意，不能够直接转换，如果status是空的话，就会全都是0，就会全都变成disable</li>
<li><code>@Provider</code> -&gt; 能够提供SQL语句的注解，有<code>@UpdataProvider</code>和<code>@SelectProvider</code>、<code>@InsertProvider</code>,不需要直接写出SQL语句。把SQL语句写到class Provider里面，通过<code>type = provider.class</code>来引用，通过<code>methor=“”</code>来调用class provider 里面的方法</li>
<li>用于动态SQL</li>
<li>
<ul>
<li><code>@Option</code> 里面的resultset为返回字段的属性（一定是SQL返回的字段属性 ）</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Mapper:
<span style="color:#a6e22e">@Options</span><span style="color:#f92672">(</span>resultSets <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;id, description, user_id, status ,create_time, update_time&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#a6e22e">@UpdateProvider</span><span style="color:#f92672">(</span>type <span style="color:#f92672">=</span> TagSqlProvider<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;updateTag&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">updateTag</span><span style="color:#f92672">(</span>Tag tag<span style="color:#f92672">);</span>

Provider<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">:</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Update tag item via specific tag.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @param tag the tag item need to update.
</span><span style="color:#75715e"> * @Return the sql to execute.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TagSqlProvider</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">updateTag</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Tag tag<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> SQL<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">{</span>
                UPDATE<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;accounting_tag&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>tag<span style="color:#f92672">.</span><span style="color:#a6e22e">getDescription</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;description = #{description}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>tag<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatus</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;status = #{status}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>tag<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserId</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user_id = #{userId}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                WHERE<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id = #{id}&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>

        <span style="color:#f92672">}.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><ul>
<li>update</li>
<li>
<ul>
<li>部分更新：从数据库拿出来的数据和更新的数据进行对比，如果更新数据中一些属性为空的话，就要判断属性是否为空，是否和数据库里面对应的属性相等。如果相等则不更新，如果不相等，就把新的数据放入database里面，注意为更新数据里为null的属性不能放入，否则就会出错。</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>对比就的和更新的数据，如果相同就不更新。</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RecordSqlProvider</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Update record item val specific record.
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @param record the record need to update
</span><span style="color:#75715e">     * @return the sql to execute
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">updateRecord</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Record record<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> SQL<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">{</span>
                UPDATE<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;accounting_record&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>record<span style="color:#f92672">.</span><span style="color:#a6e22e">getAmount</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;amount = #{amount}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>record<span style="color:#f92672">.</span><span style="color:#a6e22e">getCategory</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;category = #{category}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>record<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserId</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user_id= #{userID}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>record<span style="color:#f92672">.</span><span style="color:#a6e22e">getNote</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;note = #{note}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>record<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatus</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;status = #{status}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

</code></pre></div><ul>
<li>
<ul>
<li>全量更新：如果属性少的话可以进行全量更新,只要不是null的都更新。但是全量更新量大，不需要更新的情况下也全部更新，数据库压力就会增大。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TagSqlProvider</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Update tag item via specific tag.
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @param tag the tat item need to update
</span><span style="color:#75715e">     * @return the sql to execute
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">updateTag</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Tag tag<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> SQL<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">{</span>
                UPDATE<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;accounting_tag&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>tag<span style="color:#f92672">.</span><span style="color:#a6e22e">getDescription</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;description = #{description}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>tag<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatus</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;status = #{status}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>tag<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserId</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    SET<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user_id = #{userId}&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                WHERE<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id = #{id}&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>

        <span style="color:#f92672">}.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
</code></pre></div><h2 id="分页">分页</h2>
<ul>
<li>传统分页：一个页面展现的内容有限制，在底下或者顶部有页码选择其他的页面继续展示内容</li>
<li>Token分页、流水分页、游标分页：不断地可以往下拉。</li>
<li>完成分页就要先解决排序问题。通过<code>ORDER BY</code>进行排序</li>
<li>
<ul>
<li><code>ASC</code>正序<code>SELECT * FROM accounting_tag where user_id = 1 ORDER BY create_time </code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">id</th>
<th align="center">description</th>
<th align="center">user_id</th>
<th align="center">status</th>
<th align="center">create_time</th>
<th align="center">update_time</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">play boy</td>
<td align="center">1</td>
<td align="center">true</td>
<td align="center">2020-08-26 23:02:27.0</td>
<td align="center">2020-08-27 10:37:53.0</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">play with friend</td>
<td align="center">1</td>
<td align="center">true</td>
<td align="center">2020-08-26 23:02:56.0</td>
<td align="center"><!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">play game</td>
<td align="center">1</td>
<td align="center">true</td>
<td align="center">2020-08-26 23:13:45.0</td>
<td align="center"><!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">eat</td>
<td align="center">1</td>
<td align="center">true</td>
<td align="center">2020-08-29 00:27:45.0</td>
<td align="center"><!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">work</td>
<td align="center">1</td>
<td align="center">true</td>
<td align="center">2020-08-29 00:28:03.0</td>
<td align="center"><!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">study</td>
<td align="center">1</td>
<td align="center">true</td>
<td align="center">2020-08-29 00:28:11.0</td>
<td align="center"><!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">smoke</td>
<td align="center">1</td>
<td align="center">true</td>
<td align="center">2020-08-29 00:29:05.0</td>
<td align="center"><!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">cat</td>
<td align="center">1</td>
<td align="center">true</td>
<td align="center">2020-08-29 00:29:22.0</td>
<td align="center"><!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<ul>
<li>
<ul>
<li><code>DESC</code>倒序<br>
<code>SELECT * FROM accounting_tag where user_id = 1 ORDER BY create_time DESC</code></li>
</ul>
</li>
<li>
<ul>
<li>排序可以多个条件按先后优先次序进行
<code>SELECT * FROM accounting_record ORDER BY amount DESC , id desc</code></li>
</ul>
</li>
<li>
<p><code>LIMIT</code>进行分页</p>
</li>
<li>
<ul>
<li><code>select id ,description, user_id ,status, create_time, update_time FROM accounting_tag LIMIT 2,3</code> -&gt; 3、4、5</li>
</ul>
</li>
<li>
<ul>
<li><code>LIMIT 5</code> -&gt; 1、2、3、4、5</li>
</ul>
</li>
<li>
<p>分页插件 pagehelper-spring-boot</p>
</li>
<li>
<p>Mybatis pageInfo</p>
</li>
<li>
<ul>
<li>在使用PageInfo的时候 <code>pageNum</code>、<code>pageSize</code>等需要用到的变量一定要和文档里面的名字相同，否则就不会执行分页等方法！！！</li>
</ul>
</li>
</ul>
<h2 id="事务">事务</h2>
<ul>
<li>原子性：事物内的业务全部完成才算成功，有一步失败都会回滚到最初。</li>
<li>一致性：满足数据库完整性的约束，就是建表的时候数据的类型约束、数据范围等，都会满足。</li>
<li>隔离性：写的内容没有提交前，其他读的对象是只能够执行没有改变前的数据内容，只有写的内容提交后才能够读到变更后的内容。</li>
<li>持久性：事物一旦提交，就会永久保存到数据库里面，即使系统发生故障，数据库也能够将数据恢复。</li>
<li>read-commited 云服务器一般都会用这个，因为隔离级别比较高</li>
<li>Console <code>begin</code>并不是开始，只有执行语句才是真正的开始</li>
<li>脏读： 没有commit 的数据被 另一个console 读取到了</li>
<li>读提交（READ COMMITTED）只能看到提交的事物，但是不可重复度，因为执行多次的查询可能会得到不同的结果（因为多次查询中间如果其他事务进行了commit，查询的结果就会出现不同）</li>
<li>可重复读：在同一个事务中，多次进行查询的到的结果也是一样的，即使在多次读取的中间有其他事务进行了commit，读取的结果也不会因为其他的commit而改变。</li>
</ul>
<blockquote>
<ul>
<li>但是可能会出现幻读：在其他事务已经插入了某个ID的数据且commit，在可重复读的事务里不能够查询到这个数据，还能够用同样的ID进行数据的插入和查询，没有出现主键冲突的现象，commit后查询能够看到同一个ID插入了两条不一样的数据</li>
<li>
<ul>
<li>但是在mysql 8 后就禁用了，一般都不会出现</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li>可串行化（SERIAIZABLE）：事务查询数据时，如果其他事务在进行数据的变更时候没有commit，就必须等待直到其他事务commit后才能够查询出数据结果，否则会一直等待到超时</li>
</ul>
<h2 id="问题">问题</h2>
<p>1.关于<code>Converter</code></p>
<ul>
<li>Error:Consider defining a bean of type &lsquo;com.Procarihana.AccountingService.converter.commonToService.UserInfoCToSeConverter&rsquo; in your configuration.
解决：</li>
<li>在<code>config</code>里面给转换器配置成bean</li>
<li>@ConfigurationPropertiesBinding 注解是让 Spring Boot 知道使用该转换器做数据绑定。Mysql：<code>read log</code> 来保证事务的持久</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> com.Procarihana.AccountingService.converter.presisitenceToCommon.UserInfoPresToComConverter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.context.properties.ConfigurationPropertiesBinding<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.context.annotation.Bean<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration<span style="color:#f92672">;</span>


<span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConverterConfig</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#a6e22e">@ConfigurationPropertiesBinding</span>
    <span style="color:#66d9ef">public</span> UserInfoPresToComConverter <span style="color:#a6e22e">userInfoPresToComConverter</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> UserInfoPresToComConverter<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#a6e22e">@ConfigurationPropertiesBinding</span>
    <span style="color:#66d9ef">public</span> UserInfoCToSeConverter <span style="color:#a6e22e">userInfoCToSeConverter</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> UserInfoCToSeConverter<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ol start="2">
<li>SpringBoot运行却得到404</li>
</ol>
<ul>
<li>Error：This application has no explicit mapping for /error, so you are seeing this as a fallback.  Tue Aug 11 18:46:56 CST 2020 There was an unexpected error (type=Not Found, status=404). No message available
解决：运行业务逻辑前线运行HelloController看看有没有问题，如果没有就很大可能是Controller部分写错，例如GetMapping、参数的部分等等
注意↓等等的方式</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/{id}&#34;</span><span style="color:#f92672">)</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#66d9ef">public</span> UserInfo <span style="color:#a6e22e">getUserInfoByUserId</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span> Long userId<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
 <span style="color:#f92672">}</span>
</code></pre></div><ol start="3">
<li>Test 获得NullPointException</li>
</ol>
<blockquote>
<p>解决：可以尝试通过Debug看运行用的是那个Junit，如果是Junit 4<code>@Test</code>引入的包出现错误</p>
</blockquote>
<ul>
<li>Junit 5:import org.junit.jupiter.api.Test;</li>
<li>Junit 4:org.junit.Test</li>
</ul>
<ol start="4">
<li>Test 的时候java.lang.Exception: No runnable methods</li>
</ol>
<ul>
<li>解决：可能是因为小天才类名和要测试的类名写一样了没有加Test。不然就是<code>@test</code>没有写或者包引错了。</li>
</ul>
<ol start="5">
<li><code>mockMvc.perform(get(&quot;&quot;))</code>得到404</li>
</ol>
<ul>
<li>解决：看看url是否一致，参数有没有错，还要看url格式是否正确</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">mockMvc<span style="color:#f92672">.</span><span style="color:#a6e22e">perform</span><span style="color:#f92672">(</span>get<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/v1.0/greeting/?name=1&#34;</span><span style="color:#f92672">))</span><span style="color:#75715e">//一定是&#34;/&#34;开头！！！！！！
</span></code></pre></div><ol start="6">
<li>spotbugs:Class inherits equals() and uses Object.hashCode()</li>
</ol>
<ul>
<li>大概率是插件不被识别</li>
<li>解决：在类前加<code>@EqualsAndHashCode(callSuper = true)</code>，搭配<code>@Component</code>和构造器一起使用效果更佳</li>
<li>使用<code>@Data</code>的时候，相当于<code>@Getter @Setter @RequiredArgsConstructor @ToString @EqualsAndHashCode</code>这5个注解的合集。</li>
</ul>
<ol start="7">
<li>Bean named &lsquo;&amp;shiroFilterFactoryBean&rsquo; is expected to be of type &lsquo;org.springframework.beans.factory.config.BeanPostProcessor&rsquo; but was actually of type &lsquo;org.springframework.beans.factory.support.NullBean&rsquo;</li>
</ol>
<ul>
<li>在写的过程中可能为了方便先把<code>@Bean</code> return null，但是这种情况下系统会判定这个null 是没有意义的，就会报错。</li>
</ul>
<ol start="8">
<li>No converter found capable of converting from type [java.lang.String] to type [java.util.Map&lt;java.lang.String, org.springframework.boot.logging.LogLevel&gt;]</li>
</ol>
<ul>
<li>在application.yml里编写获得日志的过程中格式不正确,要确保空格加上呀！
<code> com.procarihana.accounting:DEBUG</code> -&gt; <code> com.procarihana.accounting: DEBUG</code></li>
</ul>
<ol start="9">
<li>There is no config
ured chain under the name/key [/v1.0/session]</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2020-08-17T09:05:23.743+0000&#34;</span>,
    <span style="color:#f92672">&#34;status&#34;</span>: <span style="color:#ae81ff">500</span>,
    <span style="color:#f92672">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;Internal Server Error&#34;</span>,
    <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;There is no configured chain under the name/key [/v1.0/session].&#34;</span>,
    <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/v1.0/session&#34;</span>
}
</code></pre></div><ul>
<li>原因：  <code>shiroFilterDefinitionMap.put(&quot;/v1.0/session/&quot;,&quot;anon&quot;);</code></li>
<li>url后面不要随便加<code>/</code>不然就会误判而访问被拒绝</li>
<li>改为<code>shiroFilterDefinitionMap.put(&quot;/v1.0/session&quot;,&quot;anon&quot;);</code>就好了</li>
</ul>
<ol start="10">
<li>Mybatis: org.apache.ibatis.reflection.reflectionexception: there is no getter for property named xxx in xx.class</li>
</ol>
<ul>
<li>原因：mapper 驼峰命名的变量名填写错误。VALUE <code>#{}</code>的内容是 在编译时变量的名字，而非对应的table的名字</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Insert</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INSERT into accounting_userinfo(username, password, salt, create_time, update_time) VALUES (#{username}, #{password}, #{salt}, #{create_time}, #{update_time})&#34;</span><span style="color:#f92672">)</span>
<span style="color:#f92672">-&gt;</span>
<span style="color:#a6e22e">@Insert</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INSERT into accounting_userinfo(username, password, salt, create_time, update_time) VALUES (#{username}, #{password}, #{salt}, #{createTime}, #{updateTime})&#34;</span><span style="color:#f92672">)</span>

</code></pre></div><ol start="11">
<li>request method &lsquo;get&rsquo; not supported</li>
</ol>
<ul>
<li>添加shiro用于访问权限，同一url的post可以运行，但是get方法不能够运行(注：gei需要在path处输入param进行访问)</li>
<li>原因：shiro权限设置的url出问题</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        shiroFilterDefinitionMap<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/v1.0/users&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;anon&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//不需要登录就能访问
</span><span style="color:#75715e"></span>
<span style="color:#f92672">--&gt;</span>
        shiroFilterDefinitionMap<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/v1.0/users/**&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;anon&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">//不需要登录就能访问
</span><span style="color:#75715e"></span>
</code></pre></div><ol start="12">
<li>github ci 检测:OuterTypeFilename</li>
</ol>
<ul>
<li>可能是因为github上文件的名字和里面calss name 不相同造成的，所以即使是本地checkStyle 成功，但是ci 还是失败。要在github上面更改文件名字才成功。</li>
<li>Travis ci 不香吗？</li>
</ul>
<ol start="13">
<li>调用<code>get</code>的时候出现</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#e6db74">&#34;status&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">415</span><span style="color:#960050;background-color:#1e0010">,</span>
    <span style="color:#e6db74">&#34;error&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;Unsupported Media Type&#34;</span><span style="color:#960050;background-color:#1e0010">,</span>
    <span style="color:#e6db74">&#34;message&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;Content type &#39;&#39; not supported&#34;</span>
</code></pre></div><ul>
<li>有可能是因为包含了consumes<code> @GetMapping(path = &quot;/{id}&quot;, produces = &quot;application/json&quot;, consumes = &quot;application/json&quot;)</code></li>
</ul>
<blockquote>
<ul>
<li>删除后就能够执行<code> @GetMapping(path = &quot;/{id}&quot;, produces = &quot;application/json;charset=utf-8&quot;)</code></li>
</ul>
</blockquote>
<ol start="14">
<li>Error: nested exception is org.springframework.<code>beans.factory.NoSuchBeanDefinitionException</code>: No qualifying bean of type &lsquo;com.procarihana.accounting.Dao.Mapper.RecordMapper&rsquo;</li>
</ol>
<ul>
<li>可能是因为Mapper的interface 没有加上<code>@Mappere</code></li>
</ul>
<ol start="15">
<li>Error:元素类型 &ldquo;foreach&rdquo; 必须后跟属性规范 &ldquo;&gt;&rdquo; 或 &ldquo;/&gt;&rdquo;</li>
</ol>
<ul>
<li>Mybatis mapper 的脚本里面<!-- raw HTML omitted -->出现问题，有可能是因为每个属性之间没有空格！！！</li>
<li>属性： <a href="https://blog.csdn.net/isea533/article/details/21237175">https://blog.csdn.net/isea533/article/details/21237175</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Insert</span><span style="color:#f92672">({</span><span style="color:#e6db74">&#34;&lt;script&gt;&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;INSERT INTO accounting_record_tag_mapping(record_id, tag_id, status) VALUES&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;&lt;foreach item=&#39;item&#39; index=&#39;index&#39; collection=&#39;recordTagMappings&#39;&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;open=&#39;(&#39;separator=&#39;),(&#39;close=&#39;)&#39;&gt;&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;#{item.recordId},#{item.tagId},#{item.status}&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;&lt;/foreach&gt;&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;&lt;/script&gt;&#34;</span><span style="color:#f92672">})</span>

        <span style="color:#f92672">--&gt;</span>

        <span style="color:#e6db74">&#34;&lt;foreach item=&#39;item&#39; index=&#39;index&#39; collection=&#39;recordTagMappings&#39;&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;open=&#39;(&#39; separator=&#39;),(&#39; close=&#39;)&#39;&gt;&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;#{item.recordId},#{item.tagId},#{item.status}&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;&lt;/foreach&gt;&#34;</span><span style="color:#f92672">,</span>
        
</code></pre></div><ol start="16">
<li>mybatis mapper 要是sql台场需要分开的话，需要特别注意空格，最好在每个分开的结尾添加空格！！！！！</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SELECT tag.id, tag.description, tag.status, tag.user_id, artm.record_id &#34;</span>
        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;FROM accounting_tag tag &#34;</span>
        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;LEFT JOIN accounting_record_tag_mapping artm &#34;</span>
        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;ON artm.tag_id = tag.id &#34;</span>
        <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;WHERE artm.record_id = #{recordId}&#34;</span><span style="color:#f92672">)</span>
</code></pre></div>
            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://procarihana.github.io/public/tags/springboot">SpringBoot</a></span><span class="tag"><a href="https://procarihana.github.io/public/tags/mybatis">Mybatis</a></span><span class="tag"><a href="https://procarihana.github.io/public/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">数据结构</a></span><span class="tag"><a href="https://procarihana.github.io/public/tags/%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2">数据模型转换</a></span><span class="tag"><a href="https://procarihana.github.io/public/tags/shiro">Shiro</a></span>
  				</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://procarihana.github.io/public/">Hana</a></span>
            
            
                <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            
            <span> <a href="https://procarihana.github.io/public/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://procarihana.github.io/public/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>



    </body>
</html>
