<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Hana ">
<meta name="description" content="代理  静态代理，工程师编辑代理类代码，实现代理模式；在编译期就生成了代理类。 基于 JDK 实现动态代理，通过jdk提供的工具方法Proxy.newProxyInstance动态构建全新的代理类(继承Proxy类，并持有InvocationHandler接口引用 )字节码文件并实例化对象返回。(jdk动- 态代理是由java内部的反射机制来实例化代理对象，并代理的调用委托类方法) 基于CGlib 动态代理模式 基于继承被代理类生成代理子类，不用实现接口。只需要被代理类是非final 类即可。(cglib动态代理底层是借助asm字节码技术 基于 Aspectj 实现动态代理（修改目标类的字节，织入代理的字节，在程序编译的时候 插入动态代理的字节码，不会生成全新的Class ） 基于 instrumentation 实现动态代理（修改目标类的字节码、类装载的时候动态拦截去修改，基于javaagent） -javaagent:spring-instrument-4.3.8.RELEASE.jar （类装载的时候 插入动态代理的字节码，不会生成全新的Class ）  CGlib  基于CGlib 技术动态代理代理类实现 (基于继承) Cglib是针对类来实现代理的，他的原理是对代理的目标类生成一个子类，并覆盖其中方法实现增强，因为底层是基于创建被代理类的一个子类，所以它避免了JDK动态代理类的缺陷。  但因为采用的是继承，所以不能对final修饰的类进行代理。final修饰的类不可继承。
JDK 动态代理  InvocationHandler接口被Proxy类回调处理，一般实现 InvocationHandler 接口的类具有委托类引用，接口方法 invoke 中添加公共代码并调用委托类的接口方法。(PersonInvocationHandler.java) JDK提供生成动态代理类的核心类Proxy ( JDK 提供的Proxy.java)  【https://cloud.tencent.com/developer/article/1461796】
一个典型的基于JDK动态代理创建对象过程可分为以下四个步骤： 1、通过实现InvocationHandler接口创建自己的调用处理器 IvocationHandler handler = new InvocationHandlerImpl(&amp;hellip;);
2、通过为Proxy类指定ClassLoader对象和一组interface代理类需要实现的接口，创建动态代理类类文件，默认JDK并不会保存这个文件到文件中；可以保存起来观察生成的代理类结构Class clazz = Proxy.getProxyClass(classLoader,new Class[]{&amp;hellip;});
3、通过上面新建的代理clazz的反射机制获取动态代理类的一个构造函数，其构造函数入参类型是调用处理器接口(IvocationHandler)类型 Constructor constructor = clazz.getConstructor(new Class[]{InvocationHandler.class});
4、通过构造函数实例创建代理类实例，此时需将调用处理器对象作为参数被传入 Interface Proxy = (Interface)constructor.newInstance(new Object[] (handler)); 为了简化对象创建过程，Proxy类中的newInstance工具方法封装了2~4，只需两步即可完成代理对象的创建。" />
<meta name="keywords" content=", AOP, 装饰器模式, Redis" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://procarihana.github.io/public/posts/aop%E5%92%8C%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%BB%A5%E5%8F%8Aredis/" />


    <title>
        
            AOP和装饰器模式以及Redis :: FAFA Blog  — Just for fun
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://procarihana.github.io/public/main.d1ea4af8fd04fb24a4f8b882ea54bd04eb245427ca4baf527c81a5dab071410b.css">






<meta itemprop="name" content="AOP和装饰器模式以及Redis">
<meta itemprop="description" content="代理  静态代理，工程师编辑代理类代码，实现代理模式；在编译期就生成了代理类。 基于 JDK 实现动态代理，通过jdk提供的工具方法Proxy.newProxyInstance动态构建全新的代理类(继承Proxy类，并持有InvocationHandler接口引用 )字节码文件并实例化对象返回。(jdk动- 态代理是由java内部的反射机制来实例化代理对象，并代理的调用委托类方法) 基于CGlib 动态代理模式 基于继承被代理类生成代理子类，不用实现接口。只需要被代理类是非final 类即可。(cglib动态代理底层是借助asm字节码技术 基于 Aspectj 实现动态代理（修改目标类的字节，织入代理的字节，在程序编译的时候 插入动态代理的字节码，不会生成全新的Class ） 基于 instrumentation 实现动态代理（修改目标类的字节码、类装载的时候动态拦截去修改，基于javaagent） -javaagent:spring-instrument-4.3.8.RELEASE.jar （类装载的时候 插入动态代理的字节码，不会生成全新的Class ）  CGlib  基于CGlib 技术动态代理代理类实现 (基于继承) Cglib是针对类来实现代理的，他的原理是对代理的目标类生成一个子类，并覆盖其中方法实现增强，因为底层是基于创建被代理类的一个子类，所以它避免了JDK动态代理类的缺陷。  但因为采用的是继承，所以不能对final修饰的类进行代理。final修饰的类不可继承。
JDK 动态代理  InvocationHandler接口被Proxy类回调处理，一般实现 InvocationHandler 接口的类具有委托类引用，接口方法 invoke 中添加公共代码并调用委托类的接口方法。(PersonInvocationHandler.java) JDK提供生成动态代理类的核心类Proxy ( JDK 提供的Proxy.java)  【https://cloud.tencent.com/developer/article/1461796】
一个典型的基于JDK动态代理创建对象过程可分为以下四个步骤： 1、通过实现InvocationHandler接口创建自己的调用处理器 IvocationHandler handler = new InvocationHandlerImpl(&hellip;);
2、通过为Proxy类指定ClassLoader对象和一组interface代理类需要实现的接口，创建动态代理类类文件，默认JDK并不会保存这个文件到文件中；可以保存起来观察生成的代理类结构Class clazz = Proxy.getProxyClass(classLoader,new Class[]{&hellip;});
3、通过上面新建的代理clazz的反射机制获取动态代理类的一个构造函数，其构造函数入参类型是调用处理器接口(IvocationHandler)类型 Constructor constructor = clazz.getConstructor(new Class[]{InvocationHandler.class});
4、通过构造函数实例创建代理类实例，此时需将调用处理器对象作为参数被传入 Interface Proxy = (Interface)constructor.newInstance(new Object[] (handler)); 为了简化对象创建过程，Proxy类中的newInstance工具方法封装了2~4，只需两步即可完成代理对象的创建。">
<meta itemprop="datePublished" content="2020-09-04T16:40:35&#43;08:00" />
<meta itemprop="dateModified" content="2020-09-04T16:40:35&#43;08:00" />
<meta itemprop="wordCount" content="1217">
<meta itemprop="image" content="https://procarihana.github.io/public/"/>



<meta itemprop="keywords" content="AOP,装饰器模式,Redis," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://procarihana.github.io/public/"/>

<meta name="twitter:title" content="AOP和装饰器模式以及Redis"/>
<meta name="twitter:description" content="代理  静态代理，工程师编辑代理类代码，实现代理模式；在编译期就生成了代理类。 基于 JDK 实现动态代理，通过jdk提供的工具方法Proxy.newProxyInstance动态构建全新的代理类(继承Proxy类，并持有InvocationHandler接口引用 )字节码文件并实例化对象返回。(jdk动- 态代理是由java内部的反射机制来实例化代理对象，并代理的调用委托类方法) 基于CGlib 动态代理模式 基于继承被代理类生成代理子类，不用实现接口。只需要被代理类是非final 类即可。(cglib动态代理底层是借助asm字节码技术 基于 Aspectj 实现动态代理（修改目标类的字节，织入代理的字节，在程序编译的时候 插入动态代理的字节码，不会生成全新的Class ） 基于 instrumentation 实现动态代理（修改目标类的字节码、类装载的时候动态拦截去修改，基于javaagent） -javaagent:spring-instrument-4.3.8.RELEASE.jar （类装载的时候 插入动态代理的字节码，不会生成全新的Class ）  CGlib  基于CGlib 技术动态代理代理类实现 (基于继承) Cglib是针对类来实现代理的，他的原理是对代理的目标类生成一个子类，并覆盖其中方法实现增强，因为底层是基于创建被代理类的一个子类，所以它避免了JDK动态代理类的缺陷。  但因为采用的是继承，所以不能对final修饰的类进行代理。final修饰的类不可继承。
JDK 动态代理  InvocationHandler接口被Proxy类回调处理，一般实现 InvocationHandler 接口的类具有委托类引用，接口方法 invoke 中添加公共代码并调用委托类的接口方法。(PersonInvocationHandler.java) JDK提供生成动态代理类的核心类Proxy ( JDK 提供的Proxy.java)  【https://cloud.tencent.com/developer/article/1461796】
一个典型的基于JDK动态代理创建对象过程可分为以下四个步骤： 1、通过实现InvocationHandler接口创建自己的调用处理器 IvocationHandler handler = new InvocationHandlerImpl(&hellip;);
2、通过为Proxy类指定ClassLoader对象和一组interface代理类需要实现的接口，创建动态代理类类文件，默认JDK并不会保存这个文件到文件中；可以保存起来观察生成的代理类结构Class clazz = Proxy.getProxyClass(classLoader,new Class[]{&hellip;});
3、通过上面新建的代理clazz的反射机制获取动态代理类的一个构造函数，其构造函数入参类型是调用处理器接口(IvocationHandler)类型 Constructor constructor = clazz.getConstructor(new Class[]{InvocationHandler.class});
4、通过构造函数实例创建代理类实例，此时需将调用处理器对象作为参数被传入 Interface Proxy = (Interface)constructor.newInstance(new Object[] (handler)); 为了简化对象创建过程，Proxy类中的newInstance工具方法封装了2~4，只需两步即可完成代理对象的创建。"/>







    <meta property="article:published_time" content="2020-09-04 16:40:35 &#43;0800 CST" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://procarihana.github.io/public/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">知っているでしょう。</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://procarihana.github.io/public/posts">CNotes</a></li><li><a href="https://procarihana.github.io/public/tags">Tags</a></li><li><a href="https://procarihana.github.io/public/notes">PNotes</a></li><li><a href="https://procarihana.github.io/public/projects">Projects</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        6 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://procarihana.github.io/public/posts/aop%E5%92%8C%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%BB%A5%E5%8F%8Aredis/">AOP和装饰器模式以及Redis</a>
      </h1>

      

      <div class="post-content">
        <h1 id="代理">代理</h1>
<ul>
<li>静态代理，工程师编辑代理类代码，实现代理模式；在编译期就生成了代理类。</li>
<li>基于 JDK 实现动态代理，通过jdk提供的工具方法Proxy.newProxyInstance动态构建全新的代理类(继承Proxy类，并持有InvocationHandler接口引用 )字节码文件并实例化对象返回。(jdk动- 态代理是由java内部的反射机制来实例化代理对象，并代理的调用委托类方法)</li>
<li>基于CGlib 动态代理模式 基于继承被代理类生成代理子类，不用实现接口。只需要被代理类是非final 类即可。(cglib动态代理底层是借助asm字节码技术</li>
<li>基于 Aspectj 实现动态代理（修改目标类的字节，织入代理的字节，在程序编译的时候 插入动态代理的字节码，不会生成全新的Class ）</li>
<li>基于 instrumentation 实现动态代理（修改目标类的字节码、类装载的时候动态拦截去修改，基于javaagent） -javaagent:spring-instrument-4.3.8.RELEASE.jar （类装载的时候 插入动态代理的字节码，不会生成全新的Class ）</li>
</ul>
<h2 id="cglib">CGlib</h2>
<ul>
<li>基于CGlib 技术动态代理代理类实现 (基于继承)</li>
<li>Cglib是针对类来实现代理的，他的原理是对代理的目标类生成一个子类，并覆盖其中方法实现增强，因为底层是基于创建被代理类的一个子类，所以它避免了JDK动态代理类的缺陷。</li>
</ul>
<p>但因为采用的是继承，所以不能对final修饰的类进行代理。final修饰的类不可继承。</p>
<h2 id="jdk-动态代理">JDK 动态代理</h2>
<ul>
<li>InvocationHandler接口被Proxy类回调处理，一般实现 InvocationHandler 接口的类具有委托类引用，接口方法 invoke 中添加公共代码并调用委托类的接口方法。(PersonInvocationHandler.java)</li>
<li>JDK提供生成动态代理类的核心类Proxy ( JDK 提供的Proxy.java)</li>
</ul>
<p>【https://cloud.tencent.com/developer/article/1461796】</p>
<h4 id="一个典型的基于jdk动态代理创建对象过程可分为以下四个步骤">一个典型的基于JDK动态代理创建对象过程可分为以下四个步骤：</h4>
<p>1、通过实现InvocationHandler接口创建自己的调用处理器 IvocationHandler handler = new InvocationHandlerImpl(&hellip;);</p>
<p>2、通过为Proxy类指定ClassLoader对象和一组interface代理类需要实现的接口，创建动态代理类类文件，默认JDK并不会保存这个文件到文件中；可以保存起来观察生成的代理类结构Class clazz = Proxy.getProxyClass(classLoader,new Class[]{&hellip;});</p>
<p>3、通过上面新建的代理clazz的反射机制获取动态代理类的一个构造函数，其构造函数入参类型是调用处理器接口(IvocationHandler)类型 Constructor constructor = clazz.getConstructor(new Class[]{InvocationHandler.class});</p>
<p>4、通过构造函数实例创建代理类实例，此时需将调用处理器对象作为参数被传入 Interface Proxy = (Interface)constructor.newInstance(new Object[] (handler)); 为了简化对象创建过程，Proxy类中的newInstance工具方法封装了2~4，只需两步即可完成代理对象的创建。</p>
<h4 id="基于jdk技术-动态代理类技术核心-proxy类和一个-invocationhandler-接口">基于JDK技术 动态代理类技术核心 Proxy类和一个 InvocationHandler 接口</h4>
<ul>
<li>java的java.lang.reflect包下提供了Proxy类和一个 InvocationHandler 接口，这个类Proxy定义了生成JDK动态代理类的方法 getProxyClass(ClassLoader loader,Class&lt;?&gt;&hellip; interfaces)生成动态代理类,返回class实例代表一个class文件。可以保存该 class 文件查看jdk生成的代理类文件长什么样</li>
<li>该生成的动态代理类继承Proxy类，(重要特性) ，并实现公共接口。</li>
<li>InvocationHandler这个接口 是被动态代理类回调的接口，我们所有需要增加的针对委托类的统一处理逻辑都增加到invoke 方法里面在调用委托类接口方法之前或之后 结束战斗。</li>
</ul>
<h4 id="缺点">缺点</h4>
<ul>
<li>JDK动态代理的代理类字节码在创建时，需要实现业务实现类所实现的接口作为参数。</li>
<li>如果业务实现类是没有实现接口而是直接定义业务方法的话，就无法使用JDK动态代理了。(JDK动态代理重要特点是代理接口) 并且，如果业务实现类中新增了接口中没有的方法，这些方法是无法被代理的（因为无法被调用）。</li>
</ul>
<p>动态代理只能对接口产生代理，不能对类产生代理</p>
<h1 id="aop">AOP</h1>
<ul>
<li>Aspect-Oriented Programming 面向切面编程</li>
<li>相当于OOP（面向对象编程）</li>
<li>AOP是面向切面变成，关注一个统一的切面</li>
<li>
<ul>
<li>切面并不是对象和方法，而是执行方法的和方法之间的一瞬间、一个面</li>
</ul>
</li>
<li>AOP和Spring是不同的东西</li>
<li>
<ul>
<li>没有Spring容器AOP也是能够工作的</li>
</ul>
</li>
<li>
<ul>
<li>Spring 通过AOP来完成一些请求</li>
</ul>
</li>
</ul>
<h4 id="aop-适用的场景">AOP 适用的场景</h4>
<ul>
<li>需要统一处理的场景</li>
<li>
<ul>
<li>日志</li>
</ul>
</li>
<li>
<ul>
<li>缓存</li>
</ul>
</li>
<li>
<ul>
<li>鉴权</li>
</ul>
</li>
</ul>
<h4 id="aop的实现">AOP的实现</h4>
<ul>
<li>JDK动态代理（Proxy）</li>
<li>
<ul>
<li>优点：⽅便，不需要依赖任何第三⽅库</li>
</ul>
</li>
<li>
<ul>
<li>缺点：功能受限，只适⽤于接⼝</li>
</ul>
</li>
<li>
<ul>
<li>OOP完成这些需求的话，需要使用到装饰器模型</li>
</ul>
</li>
<li>CGLIB/ByteBuddy字节码⽣成</li>
<li>
<ul>
<li>优点：强⼤，不受接⼝的限制</li>
</ul>
</li>
<li>
<ul>
<li>缺点：需要引⽤额外的第三⽅类库</li>
</ul>
</li>
<li>
<ul>
<li>不能增强final类/final/private⽅法</li>
</ul>
</li>
</ul>
<h4 id="aop与spring">AOP与Spring</h4>
<ul>
<li>在Spring中使⽤AOP实现Redis缓存</li>
<li>Spring是如何切换JDK动态代理和CGLIB的？</li>
<li>
<ul>
<li>spring.aop.proxy-target-class=true</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>proxy-target-class</code>属性值决定是基于接口的还是基于类的代理被创建。如果proxy-target-class 属性值被设置为true，那么基于类的代理将起作用（这时需要cglib库）。如果proxy-target-class属值被设置为false或者这个属性被省略，那么标准的JDK 基于接口的代理</li>
</ul>
</blockquote>
<ul>
<li>@Aspect声明切⾯</li>
<li>
<ul>
<li>@Before</li>
</ul>
</li>
<li>
<ul>
<li>@After</li>
</ul>
</li>
<li>
<ul>
<li>@Around(拦截目标) 包裹,拦截的条件可以通过自定义完成，不仅是通过注解标识</li>
</ul>
</li>
</ul>
<h2 id="redis">Redis</h2>
<ul>
<li>服务器分布式的情况下，通过Redis进行缓存，数据就能够被所有服务器共用</li>
<li>io（数据库）非常慢，数据在不改变的情况下进行缓存能够提高速度</li>
<li>⼴泛使⽤的内存缓存</li>
<li>常⻅的数据结构</li>
<li>String/List/Set/Hash/ZSet</li>
<li>储存的方式 Redis&lt;,&gt;，和map非常像</li>
<li>Redis为什么这么快</li>
<li>
<ul>
<li>完全基于内存</li>
</ul>
</li>
<li>
<ul>
<li>优秀的数据结构设计</li>
</ul>
</li>
<li>
<ul>
<li>单⼀线程，避免上下⽂切换开销</li>
</ul>
</li>
<li>
<ul>
<li>事件驱动，⾮阻塞</li>
</ul>
</li>
<li>redis 端口为6379</li>
</ul>
<h4 id="java-object---redis-序列化">java Object -&gt; redis (序列化)</h4>
<ul>
<li>java 自带的序列化：Serializability 接口，对象实现就能够自动进行序列化</li>
<li>json</li>
</ul>
<h2 id="装饰器模式">装饰器模式</h2>
<ul>
<li>Decorator pattern</li>
<li>动态地位一个对象增加功能，但不改变其结构</li>
<li>本质上是一个“包装”</li>
<li>
<ul>
<li>添加功能的时候不需要改变原本的对象，对对象进行包装，在执行方法的时候先执行包装的方法，再执行对象的方法</li>
</ul>
</li>
<li>装饰器模式实际的是通过业务的接口，在实现的过程中执行添加的功能，真正实现业务的是另一个实现接口的类。在执行的时候<code>new 装饰器(new 实现业务（）)</code></li>
</ul>
<h4 id="生成">生成</h4>
<ul>
<li>定义一个抽象接口，接口为对象的功能</li>
<li>实现接口功能的类（接口方法默认是多态）</li>
<li>
<ul>
<li>接口而不是通过继承父类的方式</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>接口实现没有什么成员变量，不需要实现真实的方法，而继承需要继承父类的成员变量，就会出现浪费的现象</li>
</ul>
</blockquote>
<h4 id="直接的实现login的方法">直接的实现login的方法</h4>
<ul>
<li>
<ul>
<li>先写接口</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">DataService</span> <span style="color:#f92672">{</span>
    String <span style="color:#a6e22e">a</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">);</span>
    String <span style="color:#a6e22e">b</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>再写实现，实现的过程中要直接手写log，如果有多个的话，就每一个都要写</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataServiceImpl</span> <span style="color:#66d9ef">implements</span> DataService<span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">a</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a is called! parameter is :&#34;</span><span style="color:#f92672">+</span>i<span style="color:#f92672">);</span>
        String result <span style="color:#f92672">=</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a is finished:&#34;</span><span style="color:#f92672">+</span>result<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> result<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
      <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">b</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b is called! parameter is :&#34;</span><span style="color:#f92672">+</span>i<span style="color:#f92672">);</span>
        String result <span style="color:#f92672">=</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b is finished:&#34;</span><span style="color:#f92672">+</span>result<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> result<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>运行</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataServiceMain</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">static</span> DataService service <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataServiceImpl<span style="color:#f92672">();</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        service<span style="color:#f92672">.</span><span style="color:#a6e22e">a</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><h3 id="log装饰器">log装饰器</h3>
<ul>
<li>
<ul>
<li>同样是先写接口</li>
</ul>
</li>
<li>
<ul>
<li>再写接口的实现</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataServiceImpl</span> <span style="color:#66d9ef">implements</span> DataService <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">a</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">b</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>装饰器实现接口,在override方法的时候，先实现log的方法，再完成接口需要完成的业务</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LogDecorator</span> <span style="color:#66d9ef">implements</span> DataService <span style="color:#f92672">{</span>
    DataService delegate<span style="color:#f92672">;</span><span style="color:#75715e">//委托
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">LogDecorator</span><span style="color:#f92672">(</span>DataService delegate<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">delegate</span> <span style="color:#f92672">=</span> delegate<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">a</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a is called! parameter is :&#34;</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">);</span>
        String value <span style="color:#f92672">=</span> delegate<span style="color:#f92672">.</span><span style="color:#a6e22e">a</span><span style="color:#f92672">(</span>i<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a is finished:&#34;</span> <span style="color:#f92672">+</span> value<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> value<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">b</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b is called! parameter is :&#34;</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">);</span>
        String value <span style="color:#f92672">=</span> delegate<span style="color:#f92672">.</span><span style="color:#a6e22e">a</span><span style="color:#f92672">(</span>i<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b is finished:&#34;</span> <span style="color:#f92672">+</span> value<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> value<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>运行</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>最后new出DataSerivce实例的时候，先new出Log的实例，还要记得new出实现真正实现业务接口的实例，不然log装饰器就不能够实现业务！</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataServiceMain</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">static</span> DataService service <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LogDecorator<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> DataServiceImpl<span style="color:#f92672">());</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        service<span style="color:#f92672">.</span><span style="color:#a6e22e">a</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="cache-装饰器">Cache 装饰器</h3>
<ul>
<li>把调用过的方法缓存，之后就能够直接从缓存里面拿结果</li>
<li>
<ul>
<li>用Map储存的时候，在多线程的情景下会出现线程安全的问题</li>
</ul>
</li>
<li>在logDecorate外添加一个缓存的装饰器，把方法运行的结果缓存起来</li>
<li>
<ul>
<li>首先要继承接口，把结果缓存到map里</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CacheDecorator</span> <span style="color:#66d9ef">implements</span> DataService <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span>String<span style="color:#f92672">&gt;</span> cache <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
    <span style="color:#66d9ef">private</span> DataService delegate<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String cacheLog <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cache result&#34;</span><span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">CacheDecorator</span><span style="color:#f92672">(</span>DataService delegate<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">delegate</span> <span style="color:#f92672">=</span> delegate<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">a</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        String cacheValue <span style="color:#f92672">=</span> cache<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cacheValue <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
            String realValue <span style="color:#f92672">=</span> delegate<span style="color:#f92672">.</span><span style="color:#a6e22e">a</span><span style="color:#f92672">(</span>i<span style="color:#f92672">);</span>
            cache<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span>realValue<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> realValue<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> cacheValue <span style="color:#f92672">+</span> cacheLog<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<ul>
<li>实现</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>第二次调用方法的到的结果是从缓冲里拿出来，而且缓存只是缓存业务的结果没有缓存log，所以不会有log</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataServiceMain</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">static</span> DataService service <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CacheDecorator<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> LogDecorator<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> DataServiceImpl<span style="color:#f92672">()));</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>service<span style="color:#f92672">.</span><span style="color:#a6e22e">a</span><span style="color:#f92672">(</span>1<span style="color:#f92672">));</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>service<span style="color:#f92672">.</span><span style="color:#a6e22e">a</span><span style="color:#f92672">(</span>1<span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="实现aop">实现AOP</h2>
<h3 id="jdk动态代理">JDK动态代理</h3>
<ul>
<li>需要代理去实现</li>
<li>
<ul>
<li>Returns a proxy instance for the specified interfacesthat dispatches method invocations to the specified invocation handler.</li>
</ul>
</li>
<li>
<ul>
<li>代理的实例为Object，所以要通过强制转换来完成实例对象的生成</li>
</ul>
</li>
<li>
<ul>
<li>拦截的是一个实例</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>对 InvocationHandler 看做一个中介类，中介类持有一个被代理对象，被Proxy类回调。在invoke方法中调用了被代理对象的相应方法。通过聚合方式持有被代理对象的引用，把客户端对invoke的调用最终都转为对被代理对象的调用。</li>
<li>客户端代码通过代理类引用调用接口方法时，通过代理类关联的中介类对象引用来调用中介类对象的invoke方法，从而达到代理执行被代理对象的方法。也就是说，动态代理Proxy类提供了模板实现，对外提供扩展点，外部通过实现InvocationHandler接口将被代理类纳入JDK代理类Proxy。</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">   <span style="color:#a6e22e">@CallerSensitive</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Object <span style="color:#a6e22e">newProxyInstance</span><span style="color:#f92672">(</span>ClassLoader loader<span style="color:#f92672">,</span>Class<span style="color:#f92672">&lt;?&gt;[]</span> interfaces<span style="color:#f92672">,</span>InvocationHandler h<span style="color:#f92672">){</span>
        Objects<span style="color:#f92672">.</span><span style="color:#a6e22e">requireNonNull</span><span style="color:#f92672">(</span>h<span style="color:#f92672">);</span><span style="color:#66d9ef">final</span> Class<span style="color:#f92672">&lt;?&gt;</span> caller <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecurityManager</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span>
<span style="color:#f92672">:</span> Reflection<span style="color:#f92672">.</span><span style="color:#a6e22e">getCallerClass</span><span style="color:#f92672">();</span>

        <span style="color:#75715e">/*
</span><span style="color:#75715e">         * Look up or generate the designated proxy class and its constructor.
</span><span style="color:#75715e">         */</span>
        Constructor<span style="color:#f92672">&lt;?&gt;</span> cons <span style="color:#f92672">=</span> getProxyConstructor<span style="color:#f92672">(</span>caller<span style="color:#f92672">,</span> loader<span style="color:#f92672">,</span> interfaces<span style="color:#f92672">);</span>

        <span style="color:#66d9ef">return</span> newProxyInstance<span style="color:#f92672">(</span>caller<span style="color:#f92672">,</span> cons<span style="color:#f92672">,</span> h<span style="color:#f92672">);</span>
</code></pre></div><h2 id="例子log">例子：log</h2>
<ul>
<li>实现代理的接口，从而达到动态代理的功能</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LogProxy</span> <span style="color:#66d9ef">implements</span> InvocationHandler <span style="color:#f92672">{</span>
    DataService delegate<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">LogProxy</span><span style="color:#f92672">(</span>DataService delegate<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">delegate</span> <span style="color:#f92672">=</span> delegate<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>Object proxy<span style="color:#f92672">,</span> Method method<span style="color:#f92672">,</span> Object<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>method<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is invoker:&#34;</span> <span style="color:#f92672">+</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span>args<span style="color:#f92672">));</span>
        Object retValue <span style="color:#f92672">=</span> method<span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>delegate<span style="color:#f92672">,</span> args<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>method<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;  is finished:&#34;</span> <span style="color:#f92672">+</span> retValue<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> retValue<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>实现</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataServiceMain</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">static</span> DataService service <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataServiceImpl<span style="color:#f92672">();</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        DataService dataService <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>DataService<span style="color:#f92672">)</span> Proxy
            <span style="color:#f92672">.</span><span style="color:#a6e22e">newProxyInstance</span><span style="color:#f92672">(</span>service<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">(),</span>
                <span style="color:#66d9ef">new</span> Class<span style="color:#f92672">[]</span> <span style="color:#f92672">{</span>DataService<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">},</span> <span style="color:#66d9ef">new</span> LogProxy<span style="color:#f92672">(</span>service<span style="color:#f92672">));</span>

        dataService<span style="color:#f92672">.</span><span style="color:#a6e22e">a</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="gclib-动态代理">GCLib 动态代理</h3>
<ul>
<li>拦截的是一个实例方法</li>
<li>引入GCLib maven
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->cglib<!-- raw HTML omitted -->
<!-- raw HTML omitted -->cglib<!-- raw HTML omitted -->
<!-- raw HTML omitted -->3.3.0<!-- raw HTML omitted -->
<!-- raw HTML omitted --></li>
<li>
<ul>
<li>使用enhancer（增强）来实现拦截并调用拦截方法和要执行的业务方法</li>
</ul>
</li>
</ul>
<ul>
<li>Generates dynamic subclasses to enable method interception. This</li>
<li>class started as a substitute for the standard Dynamic Proxy support</li>
<li>included with JDK 1.3, but one that allowed the proxies to extend a</li>
<li>concrete base class, in addition to implementing interfaces. The dynamically</li>
<li>generated subclasses override the non-final methods of the superclass and</li>
<li>have hooks which callback to user-defined interceptor</li>
<li>implementations.</li>
</ul>
<ul>
<li>动态生成↓的类，继承被拦截下来的类，从而能够通过强行转换的方式来生成业务和新增加功能的实例
<img src="https://procarihana.github.io/public/%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E5%AD%90%E7%B1%BB.png" alt=""></li>
</ul>
<h2 id="例子">例子</h2>
<ul>
<li>生成一个拦截类，拦截一个具体的实例方法</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LogInterceptor</span> <span style="color:#66d9ef">implements</span> MethodInterceptor <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span>  DataService delegate<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">LogInterceptor</span><span style="color:#f92672">(</span>DataService delegate<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">delegate</span> <span style="color:#f92672">=</span> delegate<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">intercept</span><span style="color:#f92672">(</span>Object o<span style="color:#f92672">,</span> Method method<span style="color:#f92672">,</span> Object<span style="color:#f92672">[]</span> objects<span style="color:#f92672">,</span> MethodProxy methodProxy<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>method<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is invoked: &#34;</span> <span style="color:#f92672">+</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span>objects<span style="color:#f92672">));</span>
        Object retValue <span style="color:#f92672">=</span> method<span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>delegate<span style="color:#f92672">,</span>objects<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>method<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()+</span><span style="color:#e6db74">&#34; is finished: &#34;</span><span style="color:#f92672">+</span>retValue<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> retValue<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>实现，通过enhancer 完成</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Main</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> DataService service <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataServiceImpl<span style="color:#f92672">();</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        Enhancer enhancer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Enhancer<span style="color:#f92672">();</span>
        enhancer<span style="color:#f92672">.</span><span style="color:#a6e22e">setSuperclass</span><span style="color:#f92672">(</span>DataServiceImpl<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span> <span style="color:#75715e">//动态代理
</span><span style="color:#75715e"></span>        enhancer<span style="color:#f92672">.</span><span style="color:#a6e22e">setCallback</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> LogInterceptor<span style="color:#f92672">(</span>service<span style="color:#f92672">));</span> <span style="color:#75715e">//动态代理被调用后，需要执行的方法
</span><span style="color:#75715e"></span>
        DataService enhancedService <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>DataService<span style="color:#f92672">)</span>enhancer<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">();</span>
        enhancedService<span style="color:#f92672">.</span><span style="color:#a6e22e">a</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><h2 id="spring-and-aop-通过gclib-和-redis-实现缓存">Spring and AOP 通过GCLib 和 redis 实现缓存</h2>
<h4 id="maven">maven</h4>
<pre><code>&lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;
    &lt;/dependency&gt;
</code></pre><h4 id="srpring-配置声明spring动态配置由gclib完成而不是jdk动态配置完成用于拦截类的方法">Srpring 配置,声明Spring动态配置由GCLib完成，而不是JDK动态配置完成,用于拦截类的方法</h4>
<p><code>spring.aop.proxy-target-class=true</code></p>
<h4 id="实现缓存---声明注解">实现缓存 -&gt; 声明注解</h4>
<ul>
<li>
<ul>
<li>使得每一个声明这个注解的方法都进去缓存切面，进行方法拦截</li>
</ul>
</li>
<li>
<ul>
<li><code>@Retention(RetentionPolicy.RUNTIME)</code>运行时才实现</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Retention</span><span style="color:#f92672">(</span>RetentionPolicy<span style="color:#f92672">.</span><span style="color:#a6e22e">RUNTIME</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">@interface</span> Cache <span style="color:#f92672">{</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="在需要运行redis-的地方加入cache来标记">在需要运行redis 的地方加入<code>@Cache</code>来标记</h4>
<ul>
<li>通常会放在Services或者Manager这层</li>
<li>因为使用的是GCLib，所以要在实现业务的类处放置，而不能够在接口处放置</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Component</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GoodsRankManagerImpl</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Cache</span>
    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>RankItem<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getGoodsRank</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> goodsRankDao<span style="color:#f92672">.</span><span style="color:#a6e22e">getGoodsRank</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="建立缓存切面-cacheaspect">建立缓存切面 CacheAspect</h4>
<ul>
<li>
<ul>
<li>使得所有拦截方法都进入这个切面的处理环境</li>
</ul>
</li>
<li>
<ul>
<li>@Aspect 声明切面</li>
</ul>
</li>
<li>
<ul>
<li>@Around(拦截目标) 包裹,拦截的条件可以通过自定义完成，不仅是通过注解标识</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>@Around(”@annotation(注解的packagename.注解name)“)</li>
</ul>
</blockquote>
<ul>
<li>
<ul>
<li>@Configuration Spring提供，声明这个类适合Spirng相关的配置</li>
</ul>
</li>
<li>
<ul>
<li>使用Map进行缓存的储存，map只会被储存在运行的服务器里面，在分布式的情况下各个机器就不能够共享数据，而通过Redis储存数据则可以达到数据共享</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Aspect</span>
<span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CacheAspect</span> <span style="color:#f92672">{</span>
    Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> cache <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>

    <span style="color:#a6e22e">@Around</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;@annotation(com.github.hcsp.anno.Cache)&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">cache</span><span style="color:#f92672">(</span>ProceedingJoinPoint joinPoint<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
        MethodSignature signature <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>MethodSignature<span style="color:#f92672">)</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">getSignature</span><span style="color:#f92672">();</span> <span style="color:#75715e">//获得方法名
</span><span style="color:#75715e"></span>        String methodName <span style="color:#f92672">=</span> signature<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">();</span>
        Object cacheValue <span style="color:#f92672">=</span> cache<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>methodName<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cacheValue <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Get value from cache&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> cacheValue<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            Object realValue <span style="color:#f92672">=</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">proceed</span><span style="color:#f92672">();</span>  <span style="color:#75715e">//执行
</span><span style="color:#75715e"></span>            cache<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>methodName<span style="color:#f92672">,</span> realValue<span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Get value from database.&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> realValue<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="通过dcoker启动redis">通过Dcoker启动Redis</h4>
<ul>
<li>持久化储存要记得映射！</li>
<li>配置Spring</li>
<li>
<ul>
<li>host 根据需求配置</li>
</ul>
</li>
</ul>
<pre><code>spring.redis.host=localhost
spring.redis.port=6379
</code></pre><ul>
<li>maven</li>
</ul>
<pre><code>   &lt;!-- spring-boot-starter-data-redis --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre><h4 id="配置redistemplate">配置RedisTemplate</h4>
<ul>
<li>
<ul>
<li>Helper class that simplifies Redis data access code. 简化redis 的数据操作</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppConfig</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Bean</span>
    RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span>Object<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">redisTemplate</span><span style="color:#f92672">(</span>RedisConnectionFactory factory<span style="color:#f92672">){</span>
        RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span>Object<span style="color:#f92672">&gt;</span> redisTemplate <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RedisTemplate<span style="color:#f92672">&lt;&gt;();</span>
        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">setConnectionFactory</span><span style="color:#f92672">(</span>factory<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="redistemplate-数据的存储">RedisTemplate 数据的存储</h4>
<ul>
<li>
<ul>
<li>opsForValue()有 set() 和get()两个方法来进行数据的存储，和map的get()、put()相似来尽心缓存数据的储存</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Aspect</span>
<span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CacheAspect</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">//  Map&lt;String, Object&gt; cache = new HashMap&lt;&gt;();
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Autowired</span>
    RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span>Object<span style="color:#f92672">&gt;</span> redisTemplate<span style="color:#f92672">;</span>
    <span style="color:#a6e22e">@Around</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;@annotation(com.github.hcsp.anno.Cache)&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">cache</span><span style="color:#f92672">(</span>ProceedingJoinPoint joinPoint<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
        MethodSignature signature <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>MethodSignature<span style="color:#f92672">)</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">getSignature</span><span style="color:#f92672">();</span> <span style="color:#75715e">//获得方法名
</span><span style="color:#75715e"></span>        String methodName <span style="color:#f92672">=</span> signature<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">();</span>
        Object cacheValue <span style="color:#f92672">=</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>methodName<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cacheValue <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Get value from cache&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> cacheValue<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            Object realValue <span style="color:#f92672">=</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">proceed</span><span style="color:#f92672">();</span>  <span style="color:#75715e">//执行
</span><span style="color:#75715e"></span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>methodName<span style="color:#f92672">,</span> realValue<span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Get value from database.&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> realValue<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><h4 id="缓存时间限制密钥超时时间限制">缓存时间限制（密钥超时时间限制）</h4>
<ul>
<li><code>Long timeout</code>为设置缓存的有效长</li>
<li><code>TimeUnit</code>设置有效时间的单位</li>
<li>
<ul>
<li>但是在测试的过程中呈现出时间控制不稳定的情况</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#75715e">/**
</span><span style="color:#75715e">	 * Set the {@code value} and expiration {@code timeout} for {@code key}.
</span><span style="color:#75715e">	 *
</span><span style="color:#75715e">	 * @param key must not be {@literal null}.
</span><span style="color:#75715e">	 * @param value must not be {@literal null}.
</span><span style="color:#75715e">	 * @param timeout the key expiration timeout.
</span><span style="color:#75715e">	 * @param unit must not be {@literal null}.
</span><span style="color:#75715e">	 * @see &lt;a href=&#34;https://redis.io/commands/setex&#34;&gt;Redis Documentation: SETEX&lt;/a&gt;
</span><span style="color:#75715e">	 */</span>
	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>K key<span style="color:#f92672">,</span> V value<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> timeout<span style="color:#f92672">,</span> TimeUnit unit<span style="color:#f92672">);</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Object realValue <span style="color:#f92672">=</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">proceed</span><span style="color:#f92672">();</span>
            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>methodName<span style="color:#f92672">,</span> realValue<span style="color:#f92672">,</span> timeout<span style="color:#f92672">,</span> TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Get value from database.&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> realValue<span style="color:#f92672">;</span>
</code></pre></div><ul>
<li>在<code>@Cache</code>里添加时间控制的方法</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Retention</span><span style="color:#f92672">(</span>RetentionPolicy<span style="color:#f92672">.</span><span style="color:#a6e22e">RUNTIME</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">@interface</span> Cache <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">cacheSeconds</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">default</span> 60<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

</code></pre></div><ul>
<li>
<ul>
<li>拦截方法出添加需要控制的时间长度</li>
</ul>
</li>
</ul>
<pre><code class="language-jav" data-lang="jav"> @Cache(cacheSeconds = 1)
    @Override
    public List&lt;RankItem&gt; getGoodsRank() {
        return goodsRankDao.getGoodsRank();
    }
</code></pre><ul>
<li>
<ul>
<li>实现方法拦截处添加getAnnotation（Cache.class）.cacheSeconds()来提取控制的时间</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#a6e22e">@Around</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;@annotation(com.github.hcsp.anno.Cache)&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">cache</span><span style="color:#f92672">(</span>ProceedingJoinPoint joinPoint<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
        MethodSignature signature <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>MethodSignature<span style="color:#f92672">)</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">getSignature</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">int</span> expireTime <span style="color:#f92672">=</span> signature<span style="color:#f92672">.</span><span style="color:#a6e22e">getMethod</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getAnnotation</span><span style="color:#f92672">(</span>Cache<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">).</span><span style="color:#a6e22e">cacheSeconds</span><span style="color:#f92672">();</span>
        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>methodName<span style="color:#f92672">,</span> realValue<span style="color:#f92672">,</span> expireTime<span style="color:#f92672">,</span> TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">);</span>
</code></pre></div><h4 id="实现controller">实现controller</h4>
<ul>
<li>通过ModleAndView 实现返回结果的渲染</li>
<li>用HashMap存储 返回结果的name 和 内容，返回模板文件name 和 modelHashmap</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RestController</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Controller</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> goodsRankManager goodsRankManager<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Controller</span><span style="color:#f92672">(</span>goodsRankManager goodsRankManager<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">goodsRankManager</span> <span style="color:#f92672">=</span> goodsRankManager<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span>path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/rank.htm&#34;</span><span style="color:#f92672">,</span> produces <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;application/json&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> ModelAndView <span style="color:#a6e22e">getGoodsRank</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>RankItem<span style="color:#f92672">&gt;</span> items <span style="color:#f92672">=</span> goodsRankManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getGoodsRank</span><span style="color:#f92672">();</span>
        HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> model <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
        model<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;items&#34;</span><span style="color:#f92672">,</span> items<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ModelAndView<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Rank&#34;</span><span style="color:#f92672">,</span> model<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="缓存的对象要实现可以序列化">缓存的对象要实现可以序列化</h4>
<ul>
<li>通过继承Serializable 可实现</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Component</span>
<span style="color:#a6e22e">@Data</span>
<span style="color:#a6e22e">@AllArgsConstructor</span>
<span style="color:#a6e22e">@NoArgsConstructor</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RankItem</span> <span style="color:#66d9ef">implements</span> Serializable <span style="color:#f92672">{</span> <span style="color:#75715e">//可序列化
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> String goodsName<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> BigDecimal totalPrice<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="问题">问题</h2>
<ol>
<li>使用到redis 的时候出现↓，且进入了死循环</li>
</ol>
<pre><code>reconnecting, last destination was localhost/127.0.0.1:6379
</code></pre><ul>
<li>可以先看一下正在运行的容器里面的redis有没有出现port 输入错误的问题……</li>
</ul>

      </div>
    </article>

    <hr />

    <div class="post-info">
        <p>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon">
            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
            <line x1="7" y1="7" x2="7" y2="7"></line>
          </svg><span class="tag"><a href="https://procarihana.github.io/public/tags/aop/">AOP</a></span><span class="tag"><a href="https://procarihana.github.io/public/tags/%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/">装饰器模式</a></span><span class="tag"><a href="https://procarihana.github.io/public/tags/redis/">Redis</a></span>
        </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        1217 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        2020-09-04 16:40 &#43;0800
      </p>
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://procarihana.github.io/public/posts/web%E9%A1%B5%E9%9D%A2-%E5%89%8D%E5%90%8E%E7%AB%AF%E6%B8%B2%E6%9F%93/">
                <span class="button__icon">←</span>
                <span class="button__text">Web页面  前后端渲染</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="https://procarihana.github.io/public/posts/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">
                <span class="button__text">正则表达式</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://procarihana.github.io/public/">Hana</a></span>
            
            
                <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            
            <span> <a href="https://procarihana.github.io/public/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://procarihana.github.io/public/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>



    </body>
</html>
