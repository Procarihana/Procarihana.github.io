<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Hana ">
<meta name="description" content="Environment DataSource   dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。
  大多数 MyBatis 应用程序会按示例中的例子来配置数据源。虽然数据源配置是可选的，但如果要启用延迟加载特性，就必须配置数据源。 有三种内建的数据源类型（也就是 type=&amp;rdquo;[UNPOOLED|POOLED|JNDI]&amp;quot;）：
   UNPOOLED– 这个数据源的实现会每次请求时打开和关闭连接。虽然有点慢，但对那些数据库连接可用性要求不高的简单应用程序来说，是一个很好的选择。 性能表现则依赖于使用的数据库，对某些数据库来说，使用连接池并不重要，这个配置就很适合这种情形。UNPOOLED 类型的数据源仅仅需要配置以下 5 种属性：      driver – 这是 JDBC 驱动的 Java 类全限定名（并不是 JDBC 驱动中可能包含的数据源类）。 url – 这是数据库的 JDBC URL 地址。 username – 登录数据库的用户名。 password – 登录数据库的密码。 defaultTransactionIsolationLevel – 默认的连接事务隔离级别。 defaultNetworkTimeout – 等待数据库操作完成的默认网络超时时间（单位：毫秒）。查看 java.sql.Connection#setNetworkTimeout() 的 API 文档以获取更多信息。 作为可选项，你也可以传递属性给数据库驱动。只需在属性名加上“driver.”前缀即可，例如：driver.encoding=UTF8这将通过 DriverManager.getConnection(url, driverProperties) 方法传递值为 UTF8 的 encoding 属性给数据库驱动。      POOLED– 这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。    除了上述提到 UNPOOLED 下的属性外，还有更多属性用来配置 POOLED 的数据源：" />
<meta name="keywords" content=", Mybatis" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://procarihana.github.io/public/notes/mybatis/" />


    <title>
        
            Mybatis :: FAFA Blog  — Just for fun
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://procarihana.github.io/public/main.d1ea4af8fd04fb24a4f8b882ea54bd04eb245427ca4baf527c81a5dab071410b.css">






<meta itemprop="name" content="Mybatis">
<meta itemprop="description" content="Environment DataSource   dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。
  大多数 MyBatis 应用程序会按示例中的例子来配置数据源。虽然数据源配置是可选的，但如果要启用延迟加载特性，就必须配置数据源。 有三种内建的数据源类型（也就是 type=&rdquo;[UNPOOLED|POOLED|JNDI]&quot;）：
   UNPOOLED– 这个数据源的实现会每次请求时打开和关闭连接。虽然有点慢，但对那些数据库连接可用性要求不高的简单应用程序来说，是一个很好的选择。 性能表现则依赖于使用的数据库，对某些数据库来说，使用连接池并不重要，这个配置就很适合这种情形。UNPOOLED 类型的数据源仅仅需要配置以下 5 种属性：      driver – 这是 JDBC 驱动的 Java 类全限定名（并不是 JDBC 驱动中可能包含的数据源类）。 url – 这是数据库的 JDBC URL 地址。 username – 登录数据库的用户名。 password – 登录数据库的密码。 defaultTransactionIsolationLevel – 默认的连接事务隔离级别。 defaultNetworkTimeout – 等待数据库操作完成的默认网络超时时间（单位：毫秒）。查看 java.sql.Connection#setNetworkTimeout() 的 API 文档以获取更多信息。 作为可选项，你也可以传递属性给数据库驱动。只需在属性名加上“driver.”前缀即可，例如：driver.encoding=UTF8这将通过 DriverManager.getConnection(url, driverProperties) 方法传递值为 UTF8 的 encoding 属性给数据库驱动。      POOLED– 这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。    除了上述提到 UNPOOLED 下的属性外，还有更多属性用来配置 POOLED 的数据源：">
<meta itemprop="datePublished" content="2020-09-01T10:57:12&#43;08:00" />
<meta itemprop="dateModified" content="2020-09-01T10:57:12&#43;08:00" />
<meta itemprop="wordCount" content="458">
<meta itemprop="image" content="https://procarihana.github.io/public/"/>



<meta itemprop="keywords" content="Mybatis," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://procarihana.github.io/public/"/>

<meta name="twitter:title" content="Mybatis"/>
<meta name="twitter:description" content="Environment DataSource   dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。
  大多数 MyBatis 应用程序会按示例中的例子来配置数据源。虽然数据源配置是可选的，但如果要启用延迟加载特性，就必须配置数据源。 有三种内建的数据源类型（也就是 type=&rdquo;[UNPOOLED|POOLED|JNDI]&quot;）：
   UNPOOLED– 这个数据源的实现会每次请求时打开和关闭连接。虽然有点慢，但对那些数据库连接可用性要求不高的简单应用程序来说，是一个很好的选择。 性能表现则依赖于使用的数据库，对某些数据库来说，使用连接池并不重要，这个配置就很适合这种情形。UNPOOLED 类型的数据源仅仅需要配置以下 5 种属性：      driver – 这是 JDBC 驱动的 Java 类全限定名（并不是 JDBC 驱动中可能包含的数据源类）。 url – 这是数据库的 JDBC URL 地址。 username – 登录数据库的用户名。 password – 登录数据库的密码。 defaultTransactionIsolationLevel – 默认的连接事务隔离级别。 defaultNetworkTimeout – 等待数据库操作完成的默认网络超时时间（单位：毫秒）。查看 java.sql.Connection#setNetworkTimeout() 的 API 文档以获取更多信息。 作为可选项，你也可以传递属性给数据库驱动。只需在属性名加上“driver.”前缀即可，例如：driver.encoding=UTF8这将通过 DriverManager.getConnection(url, driverProperties) 方法传递值为 UTF8 的 encoding 属性给数据库驱动。      POOLED– 这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。    除了上述提到 UNPOOLED 下的属性外，还有更多属性用来配置 POOLED 的数据源："/>







    <meta property="article:published_time" content="2020-09-01 10:57:12 &#43;0800 CST" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://procarihana.github.io/public/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">知っているでしょう。</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://procarihana.github.io/public/posts">CNotes</a></li><li><a href="https://procarihana.github.io/public/tags">Tags</a></li><li><a href="https://procarihana.github.io/public/notes">PNotes</a></li><li><a href="https://procarihana.github.io/public/projects">Projects</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://procarihana.github.io/public/notes/mybatis/">Mybatis</a></h2>

            

            <div class="post-content">
                <h2 id="environment">Environment</h2>
<h4 id="datasource">DataSource</h4>
<ul>
<li>
<p>dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。</p>
</li>
<li>
<p>大多数 MyBatis 应用程序会按示例中的例子来配置数据源。虽然数据源配置是可选的，但如果要启用延迟加载特性，就必须配置数据源。
有三种内建的数据源类型（也就是 type=&rdquo;[UNPOOLED|POOLED|JNDI]&quot;）：</p>
</li>
<li>
<ul>
<li>UNPOOLED– 这个数据源的实现会每次请求时打开和关闭连接。虽然有点慢，但对那些数据库连接可用性要求不高的简单应用程序来说，是一个很好的选择。 性能表现则依赖于使用的数据库，对某些数据库来说，使用连接池并不重要，这个配置就很适合这种情形。UNPOOLED 类型的数据源仅仅需要配置以下 5 种属性：</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>driver – 这是 JDBC 驱动的 Java 类全限定名（并不是 JDBC 驱动中可能包含的数据源类）。</li>
<li>url – 这是数据库的 JDBC URL 地址。</li>
<li>username – 登录数据库的用户名。</li>
<li>password – 登录数据库的密码。</li>
<li>defaultTransactionIsolationLevel – 默认的连接事务隔离级别。</li>
<li>defaultNetworkTimeout – 等待数据库操作完成的默认网络超时时间（单位：毫秒）。查看 java.sql.Connection#setNetworkTimeout() 的 API 文档以获取更多信息。</li>
<li>作为可选项，你也可以传递属性给数据库驱动。只需在属性名加上“driver.”前缀即可，例如：driver.encoding=UTF8这将通过 DriverManager.getConnection(url, driverProperties) 方法传递值为 UTF8 的 encoding 属性给数据库驱动。</li>
</ul>
</blockquote>
<ul>
<li>
<ul>
<li>POOLED– 这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。</li>
</ul>
</li>
</ul>
<p>除了上述提到 UNPOOLED 下的属性外，还有更多属性用来配置 POOLED 的数据源：</p>
<blockquote>
<ul>
<li>poolMaximumActiveConnections – 在任意时间可存在的活动（正在使用）连接数量，默认值：10</li>
<li>poolMaximumIdleConnections – 任意时间可能存在的空闲连接数。</li>
<li>poolMaximumCheckoutTime – 在被强制返回之前，池中连接被检出（checked out）时间，默认值：20000 毫秒（即 20 秒）</li>
<li>poolTimeToWait – 这是一个底层设置，如果获取连接花费了相当长的时间，连接池会打印状态日志并重新尝试获取一个连接（避免在误配置的情况下一直失败且不打印日志），默认值：20000 毫秒（即 20 秒）。
poolMaximumLocalBadConnectionTolerance – 这是一个关于坏连接容忍度的底层设置， 作用于每一个尝试从缓存池获取连接的线程。 如果这个线程获取到的是一个坏的连接，那么这个数据源允许这个线程尝试重新获取一个新的连接，但是这个重新尝试的次数不应该超过 poolMaximumIdleConnections 与 poolMaximumLocalBadConnectionTolerance 之和。 默认值：3（新增于 3.4.5）
poolPingQuery – 发送到数据库的侦测查询，用来检验连接是否正常工作并准备接受请求。默认是“NO PING QUERY SET”，这会导致多数数据库驱动出错时返回恰当的错误消息。</li>
<li>poolPingEnabled – 是否启用侦测查询。若开启，需要设置 poolPingQuery 属性为一个可执行的 SQL 语句（最好是一个速度非常快的 SQL 语句），默认值：false。</li>
<li>poolPingConnectionsNotUsedFor – 配置 poolPingQuery 的频率。可以被设置为和数据库连接超时时间一样，来避免不必要的侦测，默认值：0（即所有连接每一时刻都被侦测 — 当然仅当 poolPingEnabled 为 true 时适用）。</li>
</ul>
</blockquote>
<ul>
<li>
<ul>
<li>JNDI – 这个数据源实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的数据源引用。这种数据源配置只需要两个属性：</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>initial_context – 这个属性用来在 InitialContext 中寻找上下文（即，initialContext.lookup(initial_context)）。这是个可选属性，如果忽略，那么将会直接从 InitialContext 中寻找 data_source 属性。</li>
<li>data_source – 这是引用数据源实例位置的上下文路径。提供了 initial_context 配置时会在其返回的上下文中进行查找，没有提供时则直接在 InitialContext 中查找。</li>
</ul>
</blockquote>
<p><a href="https://mybatis.org/mybatis-3/zh/configuration.html">https://mybatis.org/mybatis-3/zh/configuration.html</a></p>
<h2 id="在springboot里配置mybatis">在SpringBoot里配置Mybatis</h2>
<h4 id="maven配置">Maven配置</h4>
<ul>
<li>SpringBoot Mybatis Maven</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">mybatis</span><span style="color:#f92672">.</span><span style="color:#a6e22e">spring</span><span style="color:#f92672">.</span><span style="color:#a6e22e">boot</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>mybatis<span style="color:#f92672">-</span>spring<span style="color:#f92672">-</span>boot<span style="color:#f92672">-</span>starter<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>version<span style="color:#f92672">&gt;</span>2<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">3</span><span style="color:#f92672">&lt;/</span>version<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
</code></pre></div><h4 id="spring的xml配置">Spring的xml配置</h4>
<ul>
<li>完成Mybatis和Spring的装配需要<code>SqlSessionFactory</code> 和 <code>mapper接口</code></li>
<li>Mybatis能够自动检测<code>DataSource</code>，然后自动生成<code>SqlSessionFactory</code>,不需要额外装配。</li>
<li>
<ul>
<li>在基础的 MyBatis 用法中，是通过 <code>SqlSessionFactoryBuilder</code>来创建 <code>SqlSessionFactory</code>的。 而在 MyBatis-Spring 中，则使用 SqlSessionFactoryBean 来创建。</li>
</ul>
</li>
<li>创建DataSource（Spring的xml配置）</li>
<li>
<ul>
<li>在resources里创建<code>application.properties</code></li>
</ul>
</li>
<li>
<ul>
<li>添加</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">spring<span style="color:#f92672">.</span><span style="color:#a6e22e">datasource</span><span style="color:#f92672">.</span><span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> jdbc<span style="color:#960050;background-color:#1e0010">：</span>mysql<span style="color:#960050;background-color:#1e0010">：</span><span style="color:#75715e">// localhost / test
</span><span style="color:#75715e"></span> spring<span style="color:#f92672">.</span><span style="color:#a6e22e">datasource</span><span style="color:#f92672">.</span><span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> dbuser
 spring<span style="color:#f92672">.</span><span style="color:#a6e22e">datasource</span><span style="color:#f92672">.</span><span style="color:#a6e22e">password</span> <span style="color:#f92672">=</span>
 dbpass spring<span style="color:#f92672">.</span><span style="color:#a6e22e">datasource</span><span style="color:#f92672">.</span><span style="color:#a6e22e">driver</span><span style="color:#f92672">-</span>class<span style="color:#f92672">-</span>name <span style="color:#f92672">=</span> com<span style="color:#f92672">.</span><span style="color:#a6e22e">mysql</span><span style="color:#f92672">.</span><span style="color:#a6e22e">cj</span><span style="color:#f92672">.</span><span style="color:#a6e22e">jdbc</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Driver</span>
 mybatis<span style="color:#f92672">.</span><span style="color:#a6e22e">config</span><span style="color:#f92672">-</span>location <span style="color:#f92672">=</span>  classpath<span style="color:#f92672">:</span>db<span style="color:#f92672">/</span>mybatis<span style="color:#f92672">/</span>Mybatis<span style="color:#f92672">-</span>config<span style="color:#f92672">.</span><span style="color:#a6e22e">xml</span>

</code></pre></div><h4 id="mybatis-配置">Mybatis 配置</h4>
<ul>
<li>MybatisConfig.xml</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;?</span>xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> <span style="color:#f92672">?&gt;</span>
<span style="color:#f92672">&lt;!</span>DOCTYPE configuration
        PUBLIC <span style="color:#e6db74">&#34;-//mybatis.org//DTD Config 3.0//EN&#34;</span>
        <span style="color:#e6db74">&#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;</span>configuration<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>settings<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>setting name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;autoMappingUnknownColumnBehavior&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;WARNING&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;</span>setting name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mapUnderscoreToCamelCase&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;</span>setting name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;jdbcTypeForNull&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;NULL&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/</span>settings<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>environments <span style="color:#66d9ef">default</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>environment id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
            
            <span style="color:#f92672">&lt;</span>transactionManager type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;JDBC&#34;</span><span style="color:#f92672">/&gt;</span>
           
            <span style="color:#f92672">&lt;</span>dataSource type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POOLED&#34;</span><span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;driver&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;jdbc:mysql://localhost:3306/user&#34;</span><span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;username&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;root&#34;</span><span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hana&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;/</span>dataSource<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;/</span>environment<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;/</span>environments<span style="color:#f92672">&gt;</span>

    <span style="color:#f92672">&lt;</span>mappers<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>mapper resource<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;db/mybatis/mapper/BlogMapper.xml&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/</span>mappers<span style="color:#f92672">&gt;</span>

<span style="color:#f92672">&lt;/</span>configuration<span style="color:#f92672">&gt;</span>

</code></pre></div><h4 id="spring-处-mybatisconfig-配置">Spring 处 mybatisConfig 配置</h4>
<pre><code>mybatis.config-location =  classpath:db/mybatis/Mybatis-config.xml
</code></pre><h4 id="mapperxml">mapper.xml</h4>
<ul>
<li>
<ul>
<li>注意<code>resultMap</code>和<code>resultType</code>的区别！</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;!</span>DOCTYPE mapper
        PUBLIC <span style="color:#e6db74">&#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;</span>
        <span style="color:#e6db74">&#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;</span><span style="color:#f92672">&gt;</span>

<span style="color:#f92672">&lt;</span>mapper namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;db.mybatis.mapper.rankItemsMapper&#34;</span><span style="color:#f92672">&gt;</span>
 <span style="color:#f92672">&lt;</span>select id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;getRank&#34;</span> resultMap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;RankMap&#34;</span><span style="color:#f92672">&gt;</span>
</code></pre></div><h4 id="dao">Dao</h4>
<ul>
<li>
<ul>
<li>sqlSession.setLest/setOne(&ldquo;select id&rdquo;)</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Repository</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GoodsRankDaoImpl</span> <span style="color:#66d9ef">implements</span> goodsRankDao <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Autowired</span>
    SqlSession sqlSession<span style="color:#f92672">;</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>RankItem<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getGoodsRank</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">selectList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;db.mybatis.mapper.rankItemsMapper.getRank&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="整理">整理</h2>
<ol>
<li>select 出来的多组数据，可暂时在mybatis 里新建一个map 储存</li>
</ol>
<pre><code>&lt;select id=&quot;getRank&quot; resultMap=&quot;RankMap&quot;&gt;
        select goods.name as goods_name,
        (case when sum(o.price * o .quantity) is null then 0 else sum(o.price * o .quantity) end) as total_price
        from `order` o right
        join goods
        on goods.id = o.goods_id
        group by goods.id order by total_price desc

    &lt;/select&gt;

    &lt;resultMap id=&quot;RankMap&quot; type=&quot;com.github.hcsp.Moudle.RankItem&quot;&gt;
        &lt;result property=&quot;goodsName&quot; column=&quot;goods_name&quot;/&gt;
        &lt;result property=&quot;totalPrice&quot; column=&quot;total_price&quot;/&gt;
    &lt;/resultMap&gt;
</code></pre><ul>
<li>再通过<code>sqlsession. selectList()</code>来得到这组数据</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>column</td>
<td>数据库中的列名，或者是列的别名。一般情况下，这和传递给 resultSet.getString(columnName) 方法的参数一样。</td>
<td></td>
</tr>
<tr>
<td>javaType</td>
<td>一个 Java 类的完全限定名，或一个类型别名（关于内置的类型别名，可以参考上面的表格）。 如果你映射到一个 JavaBean，MyBatis 通常可以推断类型。然而，如果你映射到的是 HashMap，那么你应该明确地指定 javaType 来保证行为与期望的相一致。</td>
<td></td>
</tr>
<tr>
<td>jdbcType</td>
<td>JDBC 类型，所支持的 JDBC 类型参见这个表格之前的“支持的 JDBC 类型”。 只需要在可能执行插入、更新和删除的且允许空值的列上指定 JDBC 类型。这是 JDBC 的要求而非 MyBatis 的要求。如果你直接面向 JDBC 编程，你需要对可能存在空值的列指定这个类型。</td>
<td></td>
</tr>
<tr>
<td>typeHandler</td>
<td>我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。 这个属性值是一个类型处理器实现类的完全限定名，或者是类型别名。</td>
<td></td>
</tr>
<tr>
<td>select</td>
<td>用于加载复杂类型属性的映射语句的 ID，它会从 column 属性中指定的列检索数据，作为参数传递给此 select 语句。具体请参考关联元素。</td>
<td></td>
</tr>
<tr>
<td>resultMap</td>
<td>结果映射的 ID，可以将嵌套的结果集映射到一个合适的对象树中。 它可以作为使用额外 select 语句的替代方案。它可以将多表连接操作的结果映射成一个单一的 ResultSet。这样的 ResultSet 将会将包含重复或部分数据重复的结果集。为了将结果集正确地映射到嵌套的对象树中，MyBatis 允许你 “串联”结果映射，以便解决嵌套结果集的问题。想了解更多内容，请参考下面的关联元素。</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>构造方法形参的名字。从 3.4.3 版本开始，通过指定具体的参数名，你可以以任意顺序写入 arg 元素。参看上面的解释。</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="问题">问题</h2>
<ol>
<li>在select join 的时候，select 出来的列最好as出别名，方便之后和对象数据交互的时候容易写出property</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;</span>mapper namespace<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;db.mybatis.mapper.rankItemsMapper&#34;</span><span style="color:#f92672">&gt;</span>
  <span style="color:#f92672">&lt;</span>select id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;getRank&#34;</span> resultMap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;RankMap&#34;</span><span style="color:#f92672">&gt;</span>
      select goods<span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> as goods_name<span style="color:#f92672">,</span> sum<span style="color:#f92672">(</span>o<span style="color:#f92672">.</span><span style="color:#a6e22e">price</span> <span style="color:#f92672">*</span> o <span style="color:#f92672">.</span><span style="color:#a6e22e">quantity</span><span style="color:#f92672">)</span>as total_price from
      <span style="color:#960050;background-color:#1e0010">`</span>order<span style="color:#960050;background-color:#1e0010">`</span> o right join goods
      on goods<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> o<span style="color:#f92672">.</span><span style="color:#a6e22e">goods_id</span>
      group by goods<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span> order by total_price desc
  <span style="color:#f92672">&lt;/</span>select<span style="color:#f92672">&gt;</span>

  <span style="color:#f92672">&lt;</span>resultMap id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;RankMap&#34;</span> type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;com.github.hcsp.Moudle.RankItem&#34;</span><span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;</span>result property<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;goodsName&#34;</span> column<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;goods_name&#34;</span><span style="color:#f92672">/&gt;</span>
      <span style="color:#f92672">&lt;</span>result property<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;totalPrice&#34;</span> column<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;total_price&#34;</span><span style="color:#f92672">/&gt;</span>
  <span style="color:#f92672">&lt;/</span>resultMap<span style="color:#f92672">&gt;</span>
  <span style="color:#f92672">&lt;/</span>mapper<span style="color:#f92672">&gt;</span>
</code></pre></div>
            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://procarihana.github.io/public/tags/mybatis">Mybatis</a></span>
  				</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://procarihana.github.io/public/">Hana</a></span>
            
            
                <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            
            <span> <a href="https://procarihana.github.io/public/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://procarihana.github.io/public/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>



    </body>
</html>
